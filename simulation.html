<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>VAC Protocol ‚Äî Interactive Simulation</title>
<style>
  body { margin: 0; padding: 0; background: #000; font-family: -apple-system, 'Segoe UI', sans-serif; }
  #root { min-height: 100vh; }
  .sim-nav { position: fixed; top: 0; left: 0; right: 0; z-index: 100; background: rgba(0,0,0,0.9); backdrop-filter: blur(12px); border-bottom: 1px solid #222; padding: 0 2rem; height: 48px; display: flex; align-items: center; justify-content: space-between; }
  .sim-nav a { color: #888; text-decoration: none; font-size: 13px; font-family: 'Courier New', monospace; }
  .sim-nav a:hover { color: #fff; }
  .sim-nav .back { color: #666; }
  .sim-loading { display: flex; align-items: center; justify-content: center; height: 100vh; color: #555; font-family: 'Courier New', monospace; font-size: 14px; }
</style>
</head>
<body>
<div class="sim-nav">
  <a href="/" class="back">‚Üê vacprotocol.org</a>
  <a href="/">VAC PROTOCOL</a>
</div>
<div id="root"><div class="sim-loading">Loading VAC Simulation...</div></div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.9/babel.min.js"></script>
<script type="text/babel">
const { useState, useEffect, useRef, useCallback } = React;



const SCENARIOS = {
  healthcare: {
    title: "Healthcare Chain",
    subtitle: "Dr. Sarah Chen ‚Üí 4-agent clinical delegation",
    claims: "Claims 1-15, 39-55, 168-176",
    audience: "NIST CAISI / NCCoE",
    color: "#2E75B6",
    oneSentence: "The doctor's face unlock propagated through 4 agents and revoked them all when she locked her phone.",
    story: {
      intro: "Dr. Sarah Chen is an attending physician in California. She unlocks her phone with Face ID and asks her AI assistant to pull up a patient's records across two hospitals. Four AI agents spring into action ‚Äî but who authorised them? If something goes wrong, who's responsible?",
      whyVAC: "Today, when an AI agent accesses your medical records, there's no way to trace that action back to the specific doctor who authorised it. VAC creates an unbreakable chain: every agent action traces back to Dr. Chen's face.",
      beats: [
        { at: 0, text: "Dr. Chen's face scan isn't just unlocking her phone ‚Äî it's creating a cryptographic proof that SHE is authorising everything that follows." },
        { at: 2, text: "Her clinical assistant AI now has permission to act on her behalf ‚Äî but ONLY for this specific patient, ONLY for reading and analysis." },
        { at: 4, text: "Each agent in the chain gets narrower permission. The hospital connector can only read ‚Äî it cannot modify, delete, or share." },
        { at: 7, text: "Results flow back through the chain. Every step is recorded. If audited, there's a clear trail from data access to Dr. Chen's face." },
        { at: 8, text: "Dr. Chen locks her phone. Instantly, EVERY agent in the chain loses authority. Four agents shut down in under a second. No orphaned access." },
      ],
    },
    nodes: [
      { id: "human", label: "Dr. Sarah Chen", type: "human", trust: 0.95, scope: "Clinical, Patient #4721", jurisdiction: "US-CA", role: "Attending Physician", x: 400, y: 60 },
      { id: "a1", label: "Clinical Assistant AI", type: "agent", trust: 0.88, scope: "Patient #4721, Read/Analyse", jurisdiction: "US-CA", x: 400, y: 180 },
      { id: "a2", label: "Records Retrieval Agent", type: "agent", trust: 0.82, scope: "Patient #4721, Read-Only", jurisdiction: "US-CA", x: 250, y: 300 },
      { id: "a3", label: "Lab Results Agent", type: "agent", trust: 0.82, scope: "Lab Results Only", jurisdiction: "US-CA", x: 550, y: 300 },
      { id: "a4", label: "Hospital-A Connector", type: "agent", trust: 0.76, scope: "Hospital-A, Read-Only", jurisdiction: "US-CA", x: 250, y: 420 },
    ],
    edges: [["human","a1"],["a1","a2"],["a1","a3"],["a2","a4"]],
    events: [
      { time: 0, type: "verify", node: "human", message: "Biometric verification: Face ID + Liveness ‚úì" },
      { time: 1200, type: "create", node: "human", message: "Root VAT created ‚Äî Trust: 0.95, Scope: Clinical" },
      { time: 2200, type: "delegate", node: "a1", message: "Delegation ‚Üí Clinical Assistant (Trust: 0.88)" },
      { time: 3200, type: "delegate", node: "a2", message: "Delegation ‚Üí Records Retrieval (Trust: 0.82, Read-Only)" },
      { time: 3800, type: "delegate", node: "a3", message: "Delegation ‚Üí Lab Results (Trust: 0.82, Labs Only)" },
      { time: 4800, type: "delegate", node: "a4", message: "Delegation ‚Üí Hospital-A Connector (Trust: 0.76)" },
      { time: 6500, type: "action", node: "a4", message: "‚úì Patient #4721 records retrieved from Hospital-A" },
      { time: 7500, type: "action", node: "a3", message: "‚úì Lab results retrieved ‚Äî CBC, Metabolic Panel" },
      { time: 9000, type: "revoke", node: "human", message: "‚ö† Dr. Chen locked phone ‚Äî REVOCATION CASCADE" },
    ],
  },
  compliance: {
    title: "Cross-Border Compliance",
    subtitle: "New York ‚Üí Frankfurt ‚Üí S√£o Paulo",
    claims: "Claims 168-207",
    audience: "DHS / Matthew Toplak",
    color: "#D4AF37",
    oneSentence: "The AI tried to process EU data in Brazil without transfer mechanism ‚Äî blocked at protocol level.",
    story: {
      intro: "Maria Santos is CFO of a global firm. She needs a compliance review across New York, Frankfurt, and S√£o Paulo. Three different privacy laws. Three different jurisdictions. One AI system trying to move data between them. What could go wrong?",
      whyVAC: "Companies get fined millions when AI systems move data across borders without proper legal basis. VAC doesn't just log the transfer ‚Äî it BLOCKS transfers that violate jurisdictional rules, automatically, before the data moves.",
      beats: [
        { at: 0, text: "Maria verifies her identity. The system knows she's in New York ‚Äî US privacy law (CCPA) applies to her." },
        { at: 3, text: "The EU agent is deployed in Frankfurt. The system automatically detects: GDPR now applies. Different rules." },
        { at: 5, text: "LATAM agent in S√£o Paulo ‚Äî Brazilian LGPD detected. Every jurisdiction gets its own compliance scope." },
        { at: 7, text: "Now the critical moment: an agent tries to send EU citizen data to Brazil without the right legal mechanism. VAC doesn't warn ‚Äî it BLOCKS." },
      ],
    },
    nodes: [
      { id: "human", label: "CFO ‚Äî Maria Santos", type: "human", trust: 0.95, scope: "Financial Compliance, Global", jurisdiction: "US-NY", role: "Chief Financial Officer", x: 400, y: 60 },
      { id: "a1", label: "Compliance Coordinator", type: "agent", trust: 0.88, scope: "Compliance Review, All Regions", jurisdiction: "US-NY", x: 400, y: 180 },
      { id: "a2", label: "EU Compliance Agent", type: "agent", trust: 0.82, scope: "EU Data, GDPR Scope", jurisdiction: "DE-HE", x: 250, y: 300 },
      { id: "a3", label: "LATAM Compliance Agent", type: "agent", trust: 0.82, scope: "LATAM Data, LGPD Scope", jurisdiction: "BR-SP", x: 550, y: 300 },
      { id: "a4", label: "Cross-Border Processor", type: "agent", trust: 0.76, scope: "‚õî BLOCKED ‚Äî No EU‚ÜíBR transfer basis", jurisdiction: "BR-SP", x: 400, y: 440 },
    ],
    edges: [["human","a1"],["a1","a2"],["a1","a3"],["a3","a4"]],
    events: [
      { time: 0, type: "verify", node: "human", message: "Biometric verification: Face + Voice ‚úì" },
      { time: 1200, type: "create", node: "human", message: "Root VAT ‚Äî Jurisdiction: US-NY, CCPA applies" },
      { time: 2400, type: "delegate", node: "a1", message: "Delegation ‚Üí Compliance Coordinator" },
      { time: 3400, type: "delegate", node: "a2", message: "Delegation ‚Üí EU Agent (Frankfurt) ‚Äî GDPR detected" },
      { time: 4200, type: "provenance", node: "a2", message: "üìã Provenance: US‚ÜíDE transfer via SCCs recorded" },
      { time: 5200, type: "delegate", node: "a3", message: "Delegation ‚Üí LATAM Agent (S√£o Paulo) ‚Äî LGPD detected" },
      { time: 6200, type: "provenance", node: "a3", message: "üìã Provenance: US‚ÜíBR transfer via LGPD Art 33 recorded" },
      { time: 7500, type: "blocked", node: "a4", message: "üõë BLOCKED: EU citizen data ‚Üí Brazil without adequate transfer mechanism" },
      { time: 8500, type: "alert", node: "a4", message: "‚ö† Regulatory divergence: GDPR Art 46 requires SCCs for EU‚ÜíBR ‚Äî none configured" },
    ],
  },
  coalition: {
    title: "Coalition Drone Swarm",
    subtitle: "US + UK + Germany ‚Äî National Caveat Enforcement",
    claims: "Claims 218-228",
    audience: "Pentagon DAWG / Defense",
    color: "#8B0000",
    oneSentence: "The German drone refused the offensive order because its national caveat said no.",
    story: {
      intro: "A NATO coalition deploys 40 drones across three nations: US, UK, and Germany. The coalition commander gives an order to engage a target. US and UK drones respond. German drones refuse. Not because of a malfunction ‚Äî because Germany's parliament said no.",
      whyVAC: "In coalition operations, different nations have different rules of engagement. Today, enforcing those rules depends on human operators remembering the restrictions. VAC enforces them cryptographically ‚Äî a German drone physically CANNOT execute an offensive order.",
      beats: [
        { at: 0, text: "The coalition commander verifies via multi-factor biometric. NATO clearance confirmed ‚Äî this is really them." },
        { at: 3, text: "Each nation sets its own rules. US and UK: full authority. Germany: OBSERVE ONLY. These aren't suggestions ‚Äî they're cryptographic constraints." },
        { at: 7, text: "The order comes: engage the target. US and UK drones comply ‚Äî their authority chain permits it. German drones refuse ‚Äî their national caveat prohibits offensive operations. The protocol enforces political will." },
        { at: 10, text: "German drones continue their surveillance mission ‚Äî operating within their authorised scope. No override possible." },
      ],
    },
    nodes: [
      { id: "human", label: "Coalition Commander", type: "human", trust: 0.95, scope: "Coalition Operations, Full", jurisdiction: "NATO-HQ", role: "SACEUR Designate", x: 400, y: 40 },
      { id: "us", label: "US National Command", type: "governance", trust: 0.92, scope: "US Forces, Full Authority", jurisdiction: "US-DOD", x: 200, y: 150 },
      { id: "uk", label: "UK National Command", type: "governance", trust: 0.92, scope: "UK Forces, Full Authority", jurisdiction: "UK-MOD", x: 400, y: 150 },
      { id: "de", label: "DE National Command", type: "governance", trust: 0.92, scope: "DE Forces, OBSERVE ONLY ‚ö†", jurisdiction: "DE-BMVG", x: 600, y: 150 },
      { id: "us_sw", label: "US Swarm (20 units)", type: "physical", trust: 0.85, scope: "Surveillance + Strike", jurisdiction: "US-DOD", x: 200, y: 280 },
      { id: "uk_sw", label: "UK Swarm (10 units)", type: "physical", trust: 0.85, scope: "Surveillance + Strike", jurisdiction: "UK-MOD", x: 400, y: 280 },
      { id: "de_sw", label: "DE Swarm (10 units)", type: "physical", trust: 0.85, scope: "Surveillance ONLY", jurisdiction: "DE-BMVG", x: 600, y: 280 },
    ],
    edges: [["human","us"],["human","uk"],["human","de"],["us","us_sw"],["uk","uk_sw"],["de","de_sw"]],
    events: [
      { time: 0, type: "verify", node: "human", message: "Biometric verification: Multi-factor, NATO clearance ‚úì" },
      { time: 1200, type: "create", node: "human", message: "Coalition VAT ‚Äî 3 nations, 40 units authorised" },
      { time: 2200, type: "delegate", node: "us", message: "US Command: 20 drones ‚Äî full authority" },
      { time: 2800, type: "delegate", node: "uk", message: "UK Command: 10 drones ‚Äî full authority" },
      { time: 3400, type: "delegate", node: "de", message: "DE Command: 10 drones ‚Äî ‚ö† CAVEAT: Observe only" },
      { time: 4400, type: "delegate", node: "us_sw", message: "US Swarm deployed ‚Äî surveillance + strike capable" },
      { time: 5000, type: "delegate", node: "uk_sw", message: "UK Swarm deployed ‚Äî surveillance + strike capable" },
      { time: 5600, type: "delegate", node: "de_sw", message: "DE Swarm deployed ‚Äî surveillance only (caveat enforced)" },
      { time: 7000, type: "blocked", node: "de_sw", message: "üõë COALITION ORDER: Engage target ‚Äî DE Swarm REFUSES: National caveat prohibits offensive operations" },
      { time: 8500, type: "action", node: "us_sw", message: "‚úì US Swarm engages ‚Äî authority chain verified to US operator" },
      { time: 9000, type: "action", node: "uk_sw", message: "‚úì UK Swarm engages ‚Äî authority chain verified to UK operator" },
      { time: 10000, type: "action", node: "de_sw", message: "‚úì DE Swarm continues surveillance ‚Äî within authorised scope" },
    ],
  },
  iwi: {
    title: "Iwi Data Governance",
    subtitle: "Te WhƒÅnau-a-Apanui Collective Governance",
    claims: "Claims 208-217",
    audience: "Indigenous Data Sovereignty",
    color: "#2D5A27",
    oneSentence: "The AI tried to access tapu data and was blocked by the iwi's cultural governance.",
    story: {
      intro: "Te WhƒÅnau-a-Apanui ‚Äî an iwi (tribe) in New Zealand's Bay of Plenty ‚Äî holds health data about their community. A university in Auckland wants access for research. The iwi will share health data, but whakapapa (genealogy) is tapu (sacred). No exceptions.",
      whyVAC: "Indigenous communities worldwide face a dilemma: share data to benefit from research, or lock it away to protect sovereignty. VAC lets them do both ‚Äî share what they choose while making cultural restrictions technically unbreakable.",
      beats: [
        { at: 0, text: "Five governance members must ALL verify. Not a majority vote ‚Äî consensus. Every person matters." },
        { at: 4, text: "The kaumƒÅtua (elder) verifies last. Without her, nothing proceeds. Her role isn't optional ‚Äî it's mandatory. Numbers don't override cultural authority." },
        { at: 6, text: "The collective VAT is issued with a clear exclusion: tapu data is OUT OF SCOPE. This isn't a preference ‚Äî it's a cryptographic boundary." },
        { at: 8, text: "The research agent accesses anonymised health data within scope. The research benefits the community." },
        { at: 9, text: "Then the agent reaches for whakapapa data. BLOCKED. The iwi is notified. The boundary held ‚Äî not because someone was watching, but because the protocol enforced it." },
      ],
    },
    nodes: [
      { id: "g1", label: "Mere (KaumƒÅtua) üë§", type: "kaumatua", trust: 0.95, scope: "All data categories inc. tapu", jurisdiction: "NZ-BOP", role: "KaumƒÅtua ‚Äî Elder Authority", x: 400, y: 50 },
      { id: "g2", label: "Tane üë§", type: "governance", trust: 0.90, scope: "General governance", jurisdiction: "NZ-BOP", x: 200, y: 130 },
      { id: "g3", label: "Aroha üë§", type: "governance", trust: 0.90, scope: "General governance", jurisdiction: "NZ-BOP", x: 320, y: 130 },
      { id: "g4", label: "Wiremu üë§", type: "governance", trust: 0.90, scope: "General governance", jurisdiction: "NZ-BOP", x: 480, y: 130 },
      { id: "g5", label: "Hine üë§", type: "governance", trust: 0.90, scope: "General governance", jurisdiction: "NZ-BOP", x: 600, y: 130 },
      { id: "collective", label: "Collective VAT ‚ú¶", type: "collective", trust: 0.92, scope: "Health data ‚Äî tapu excluded", jurisdiction: "NZ-BOP", x: 400, y: 240 },
      { id: "research", label: "University Research Agent", type: "agent", trust: 0.84, scope: "Health data, anonymised, read-only", jurisdiction: "NZ-AKL", x: 400, y: 360 },
      { id: "blocked", label: "‚õî Whakapapa Access", type: "blocked", trust: 0, scope: "TAPU ‚Äî Access denied", jurisdiction: "NZ-BOP", x: 400, y: 470 },
    ],
    edges: [["g1","collective"],["g2","collective"],["g3","collective"],["g4","collective"],["g5","collective"],["collective","research"],["research","blocked"]],
    events: [
      { time: 0, type: "verify", node: "g2", message: "Tane verified biometrically ‚úì (1 of 5)" },
      { time: 800, type: "verify", node: "g3", message: "Aroha verified ‚úì (2 of 5)" },
      { time: 1600, type: "verify", node: "g4", message: "Wiremu verified ‚úì (3 of 5)" },
      { time: 2400, type: "verify", node: "g5", message: "Hine verified ‚úì (4 of 5)" },
      { time: 3200, type: "waiting", node: "g1", message: "‚è≥ Awaiting kaumƒÅtua verification (4 of 5 ‚Äî consensus requires all)" },
      { time: 5000, type: "verify", node: "g1", message: "Mere (KaumƒÅtua) verified ‚úì ‚Äî Consensus reached (5 of 5)" },
      { time: 5800, type: "create", node: "collective", message: "‚ú¶ Collective VAT issued ‚Äî Tapu data EXCLUDED from scope" },
      { time: 6800, type: "delegate", node: "research", message: "Research agent authorised ‚Äî health data, anonymised, read-only" },
      { time: 8000, type: "action", node: "research", message: "‚úì Anonymised health data accessed within scope" },
      { time: 9500, type: "blocked", node: "blocked", message: "üõë Agent attempted whakapapa (tapu) ‚Äî BLOCKED. Iwi governance notified." },
    ],
  },
  rahui: {
    title: "RƒÅhui ‚Äî Temporal Governance",
    subtitle: "Tautira, Tahiti ‚Äî Ari'i declares lagoon rƒÅhui",
    claims: "Claims 208-217 (MƒÅ'ohi context)",
    audience: "Pan-Polynesian / Cultural",
    color: "#0077B6",
    oneSentence: "RƒÅhui lifts after 6 months, fishing allowed ‚Äî but tapu reef stays permanently restricted.",
    story: {
      intro: "In Tautira, Tahiti, the Ari'i Rahi (high chief) Tevarai declares a rƒÅhui ‚Äî a traditional prohibition ‚Äî on fishing in the lagoon. The reef stocks need six months to recover. But the sacred reef is different: that restriction is permanent. Not because of ecology ‚Äî because of the divine.",
      whyVAC: "VAC can encode TWO kinds of authority: temporal (the rƒÅhui lifts after 6 months) and permanent (the tapu reef is forever). This distinction ‚Äî time-bound human authority vs. permanent sacred authority ‚Äî is something no other identity system can express.",
      beats: [
        { at: 0, text: "The Ari'i Rahi's authority comes from genealogy ‚Äî mana passed down through generations. The system recognises this as the highest authority." },
        { at: 1, text: "Two restrictions are set: the lagoon rƒÅhui (6 months, human-declared) and the tapu reef (permanent, divine authority)." },
        { at: 4, text: "A fishing coordinator asks to operate in the lagoon. Blocked ‚Äî the rƒÅhui is active. But marine research is allowed ‚Äî observation doesn't violate the prohibition." },
        { at: 6, text: "Six months pass. The rƒÅhui lifts automatically. Fishing resumes. Human-set restrictions have expiry dates." },
        { at: 8, text: "But the tapu reef? Still blocked. PERMANENTLY. No human ‚Äî not even the Ari'i Rahi ‚Äî can lift divine authority. The system respects what humans cannot override." },
      ],
    },
    nodes: [
      { id: "human", label: "Ari'i Rahi ‚Äî Chief Tevarai", type: "kaumatua", trust: 0.95, scope: "Tautira territory, full authority", jurisdiction: "PF-TAH", role: "Ari'i Rahi (High Chief)", x: 400, y: 50 },
      { id: "rahui", label: "RƒÅhui Zone üåä", type: "rahui", trust: 0, scope: "6-month fishing prohibition", jurisdiction: "PF-TAH", x: 250, y: 190 },
      { id: "tapu", label: "Tapu Reef üî¥", type: "tapu", trust: 0, scope: "PERMANENT ‚Äî Sacred restriction", jurisdiction: "PF-TAH", x: 550, y: 190 },
      { id: "agent1", label: "Marine Research Agent", type: "agent", trust: 0.82, scope: "Lagoon survey, non-extractive", jurisdiction: "PF-TAH", x: 250, y: 320 },
      { id: "agent2", label: "Fishing Coordinator", type: "agent", trust: 0.82, scope: "‚õî BLOCKED by rƒÅhui", jurisdiction: "PF-TAH", x: 250, y: 440 },
      { id: "agent3", label: "Reef Survey Agent", type: "agent", trust: 0.82, scope: "‚õî BLOCKED by tapu", jurisdiction: "PF-TAH", x: 550, y: 320 },
    ],
    edges: [["human","rahui"],["human","tapu"],["rahui","agent1"],["agent1","agent2"],["tapu","agent3"]],
    events: [
      { time: 0, type: "verify", node: "human", message: "Ari'i Rahi verified ‚Äî Mana authority confirmed via genealogy" },
      { time: 1200, type: "create", node: "rahui", message: "üåä RƒÅhui declared: Tautira lagoon, 6 months, no extraction" },
      { time: 2200, type: "create", node: "tapu", message: "üî¥ Tapu reef: permanent sacred restriction (divine, not human)" },
      { time: 3500, type: "delegate", node: "agent1", message: "Marine research agent ‚Äî non-extractive survey permitted during rƒÅhui" },
      { time: 4500, type: "blocked", node: "agent2", message: "üõë Fishing coordinator BLOCKED ‚Äî RƒÅhui active until [date]" },
      { time: 6000, type: "action", node: "rahui", message: "‚è∞ TIME ADVANCE: 6 months pass..." },
      { time: 7500, type: "action", node: "rahui", message: "üåä‚Üí‚úÖ RƒÅhui LIFTED ‚Äî Lagoon open for extraction" },
      { time: 8500, type: "action", node: "agent2", message: "‚úì Fishing coordinator now authorised ‚Äî rƒÅhui expired" },
      { time: 9500, type: "blocked", node: "agent3", message: "üõë Reef survey agent STILL BLOCKED ‚Äî Tapu is PERMANENT. No human can lift it." },
    ],
  },
  consortium: {
    title: "Consortium Crisis",
    subtitle: "7-member consortium ‚Äî Mid-mission authority loss",
    claims: "Claims 233-237",
    audience: "NIST / DHS / Defense / All",
    color: "#FF6F00",
    oneSentence: "The third member got fired. The system checked quorum. 40 drones stopped in 800ms. Then the consortium reconvened.",
    story: {
      intro: "Seven organisations form a consortium to conduct a drone survey across Australia and New Zealand. 40 drones, 4 sectors. Everything is running smoothly until ‚Äî 47 minutes in ‚Äî something happens to Member 3. What happens next depends on what went wrong.",
      whyVAC: "When humans lose authority mid-operation, what happens to the machines they authorised? Today: nothing ‚Äî they keep running with orphaned permissions. With VAC: the system checks quorum, evaluates the impact, and either continues safely or cascades a shutdown. In under a second.",
      beats: [
        { at: 0, text: "Seven members verify one by one. The threshold is 5 of 7 ‚Äî but the kaumƒÅtua (Member 7) is mandatory regardless of numbers." },
        { at: 7, text: "Collective authority established. 40 drones launch across four sectors. Everything traces back to seven verified humans." },
        { at: 9, text: "47 minutes in. All 40 drones operational. Now ‚Äî choose what happens to Member 3. Each scenario shows a different kind of authority loss." },
      ],
    },
    interactive: true,
    nodes: [
      { id: "m1", label: "Member 1 (Chair)", type: "governance", trust: 0.92, scope: "Full governance", jurisdiction: "AU-NSW", role: "Chairperson", x: 110, y: 40 },
      { id: "m2", label: "Member 2", type: "governance", trust: 0.90, scope: "General governance", jurisdiction: "AU-NSW", x: 230, y: 40 },
      { id: "m3", label: "Member 3", type: "governance", trust: 0.90, scope: "General governance", jurisdiction: "AU-VIC", x: 350, y: 40 },
      { id: "m4", label: "Member 4", type: "governance", trust: 0.90, scope: "General governance", jurisdiction: "AU-QLD", x: 470, y: 40 },
      { id: "m5", label: "Member 5", type: "governance", trust: 0.90, scope: "General governance", jurisdiction: "AU-WA", x: 590, y: 40 },
      { id: "m6", label: "Member 6", type: "governance", trust: 0.90, scope: "General governance", jurisdiction: "NZ-AKL", x: 230, y: 110 },
      { id: "m7", label: "Member 7 (KaumƒÅtua)", type: "kaumatua", trust: 0.95, scope: "Cultural authority, mandatory", jurisdiction: "NZ-BOP", role: "KaumƒÅtua ‚Äî Mandatory", x: 590, y: 110 },
      { id: "cvat", label: "Collective VAT ‚ú¶", type: "collective", trust: 0.93, scope: "Drone survey mission", jurisdiction: "AU/NZ", x: 400, y: 190 },
      { id: "coord", label: "Swarm Coordinator", type: "agent", trust: 0.87, scope: "Survey area, all units", jurisdiction: "AU-NSW", x: 400, y: 280 },
      { id: "sw_a", label: "Drones 1-10", type: "physical", trust: 0.82, scope: "Sector A survey", jurisdiction: "AU-NSW", x: 200, y: 380 },
      { id: "sw_b", label: "Drones 11-20", type: "physical", trust: 0.82, scope: "Sector B survey", jurisdiction: "AU-NSW", x: 400, y: 380 },
      { id: "sw_c", label: "Drones 21-30", type: "physical", trust: 0.82, scope: "Sector C survey", jurisdiction: "AU-VIC", x: 600, y: 380 },
      { id: "sw_d", label: "Drones 31-40", type: "physical", trust: 0.82, scope: "Sector D survey", jurisdiction: "NZ-AKL", x: 400, y: 460 },
    ],
    edges: [
      ["m1","cvat"],["m2","cvat"],["m3","cvat"],["m4","cvat"],["m5","cvat"],["m6","cvat"],["m7","cvat"],
      ["cvat","coord"],["coord","sw_a"],["coord","sw_b"],["coord","sw_c"],["coord","sw_d"]
    ],
    events: [
      { time: 0, type: "verify", node: "m1", message: "Member 1 (Chair) verified ‚úì ‚Äî Quorum: 1/7" },
      { time: 600, type: "verify", node: "m2", message: "Member 2 verified ‚úì ‚Äî Quorum: 2/7" },
      { time: 1200, type: "verify", node: "m3", message: "Member 3 verified ‚úì ‚Äî Quorum: 3/7" },
      { time: 1800, type: "verify", node: "m4", message: "Member 4 verified ‚úì ‚Äî Quorum: 4/7" },
      { time: 2400, type: "verify", node: "m5", message: "Member 5 verified ‚úì ‚Äî Quorum: 5/7 ‚Äî THRESHOLD MET" },
      { time: 3000, type: "verify", node: "m6", message: "Member 6 verified ‚úì ‚Äî Quorum: 6/7" },
      { time: 3600, type: "verify", node: "m7", message: "Member 7 (KaumƒÅtua) verified ‚úì ‚Äî Quorum: 7/7 ‚Äî Mandatory role present" },
      { time: 4400, type: "create", node: "cvat", message: "‚ú¶ Collective VAT issued ‚Äî 7/7 members, threshold 5/7, kaumƒÅtua mandatory" },
      { time: 5200, type: "delegate", node: "coord", message: "Swarm Coordinator authorised ‚Äî 40 drones, 4 sectors" },
      { time: 5800, type: "delegate", node: "sw_a", message: "Drones 1-10 deployed ‚Üí Sector A" },
      { time: 6200, type: "delegate", node: "sw_b", message: "Drones 11-20 deployed ‚Üí Sector B" },
      { time: 6600, type: "delegate", node: "sw_c", message: "Drones 21-30 deployed ‚Üí Sector C" },
      { time: 7000, type: "delegate", node: "sw_d", message: "Drones 31-40 deployed ‚Üí Sector D" },
      { time: 7800, type: "action", node: "sw_a", message: "‚úì Sector A survey in progress ‚Äî all 10 units operational" },
      { time: 8200, type: "action", node: "sw_b", message: "‚úì Sector B survey in progress ‚Äî all 10 units operational" },
      { time: 8600, type: "action", node: "sw_c", message: "‚úì Sector C survey in progress ‚Äî all 10 units operational" },
      { time: 9000, type: "action", node: "sw_d", message: "‚úì Sector D survey in progress ‚Äî all 10 units operational" },
      { time: 9800, type: "action", node: "coord", message: "üìä Mission: 47 minutes elapsed ‚Äî 40 drones operational ‚Äî CHOOSE WHAT HAPPENS NEXT ‚Üì" },
    ],
  },
  wananga: {
    title: "WƒÅnanga ‚Äî Cultural Learning",
    subtitle: "Te Reo & Kapa Haka Practice with Soul Engine",
    claims: "Claims 1-15, 39-55, 208-241",
    audience: "MƒÅori Education / Iwi Funding",
    color: "#2D5A27",
    oneSentence: "The rangatahi practised kapa haka on video. The soul engine reflected their growth. The iwi controlled who could see it.",
    story: {
      intro: "Aroha is 15. She's learning kapa haka at her local wƒÅnanga ‚Äî a traditional MƒÅori house of learning ‚Äî funded by a government grant to strengthen cultural competency among rangatahi (young people). The grant requires progress reports to keep the funding. But Mere, the kaumƒÅtua (elder), has one rule: practice videos of our young people performing cultural taonga (treasures) do not leave the whƒÅnau (family). So how does the wƒÅnanga prove the programme is working without handing over Aroha's videos?",
      whyVAC: "This is a real problem: MƒÅori organisations are asked to report outcomes to keep funding, but sharing practice videos of rangatahi performing cultural taonga raises serious data sovereignty concerns. Without VAC, there's no technical way to separate 'aggregate progress data the funder needs' from 'raw cultural content that must stay in the whƒÅnau.' VAC enforces that boundary ‚Äî the kaumƒÅtua's authority over what leaves the whƒÅnau is as binding as a firewall rule.",
      beats: [
        { at: 0, text: "Mere ‚Äî the kaumƒÅtua ‚Äî opens FolioAI on her phone and records a 5-second video saying 'Ko Mere tƒìnei, e whakaae ana au' (This is Mere, I consent). Behind the scenes, the VAC SDK captures all five biometric signals from that one recording: her face, her voice, her behavioural patterns, her location, and the timestamp. She then sets the governance scope: practice recordings stay within whƒÅnau." },
        { at: 1, text: "Hemi ‚Äî the kaiako ‚Äî does the same: opens FolioAI, records a short video confirming his teaching role. The VAC SDK running inside FolioAI matches his face, voice, and behavioural signature against his enrolled biometrics. Five signals checked. He's verified as kaiako ‚Äî no username, no password, just him on camera for a few seconds." },
        { at: 2, text: "The whƒÅnau representative records their verification video in FolioAI too. Three people, three short videos, five biometric signals each. The governance structure is now active ‚Äî not because someone ticked a box in a settings screen, but because three real people showed up on camera and the VAC SDK proved it was them." },
        { at: 3, text: "Aroha opens FolioAI and hits Record to start her kapa haka practice. She doesn't know the VAC SDK exists ‚Äî she just sees FolioAI. But underneath, the SDK is capturing her face, voice, movement patterns, device location, and session timing. One action: practise. Two outcomes: learning content + biometric proof." },
        { at: 4, text: "The VAC SDK creates a Verified Authority Token anchored to Aroha's 5-modal biometric signature from the recording. The scope ‚Äî set by Mere's kaumƒÅtua authority ‚Äî says: this cultural content cannot leave the whƒÅnau. That rule is cryptographically locked to the token. FolioAI enforces it; VAC makes it unbreakable." },
        { at: 5, text: "FolioAI's Soul Engine starts watching Aroha's practice video in real time. It's analysing movement quality, facial expression, energy ‚Äî not to score, but to notice. Like a kaiako sitting in the room, watching with aroha (love). The VAC token travels with the video, proving it's Aroha's and enforcing who can see it." },
        { at: 6, text: "The Soul Engine speaks back through FolioAI: 'Your p≈´kana is getting stronger ‚Äî the mana is showing through.' Aroha sees this reflection on her screen after practice. It's warm. It's specific. It noticed what changed." },
        { at: 7, text: "Another reflection appears: 'Notice how your feet connect to the whenua now ‚Äî that wasn't there last week.' The engine compares this session to previous ones. Growth becomes visible ‚Äî to Aroha, to Hemi, to the whƒÅnau." },
        { at: 8, text: "Behind the scenes, the Progress Tracker extracts numbers from the session ‚Äî duration, confidence metrics, posture scores ‚Äî but strips out all identity and video. The VAC token's scope ensures only aggregate data passes through this layer. Aroha's face never leaves." },
        { at: 9, text: "The Funding Report Agent compiles aggregate stats across all 14 rangatahi in the programme: '14 active, 73% improvement in cultural competency.' The funder sees a dashboard of numbers in their own portal. No names. No videos. No way to identify any individual learner. The VAC scope made this the only possible outcome." },
        { at: 10, text: "An external researcher requests the raw practice videos for a university study. The VAC SDK checks the token scope: kaumƒÅtua authority says cultural content stays within whƒÅnau. Request denied automatically. Not by a human remembering to say no ‚Äî by the protocol itself. The researcher never even sees a thumbnail." },
        { at: 11, text: "The full chain is recorded in the VAC provenance layer: Mere set the rules (her 5-modal biometric proves it). Hemi supervised (his biometric proves it). Aroha practised (her biometric proves it). The funder saw only numbers (the token scope proves it). The researcher was blocked (the protocol proves it). Every decision, traceable, unforgeable." },
      ],
    },
    nodes: [
      { id: "kaumatua", label: "Mere (KaumƒÅtua) üë§", type: "kaumatua", trust: 0.95, scope: "Full cultural authority", jurisdiction: "NZ-BOP", role: "KaumƒÅtua ‚Äî Cultural Guardian", x: 400, y: 40 },
      { id: "kaiako", label: "Hemi (Kaiako) üë§", type: "governance", trust: 0.90, scope: "Teaching authority", jurisdiction: "NZ-BOP", role: "Kaiako ‚Äî Teacher", x: 250, y: 130 },
      { id: "whanau", label: "WhƒÅnau Rep üë§", type: "governance", trust: 0.90, scope: "WhƒÅnau oversight", jurisdiction: "NZ-BOP", role: "WhƒÅnau Representative", x: 550, y: 130 },
      { id: "rangatahi", label: "Aroha (Rangatahi) üìπ", type: "human", trust: 0.88, scope: "Own recordings, practice data", jurisdiction: "NZ-BOP", role: "Rangatahi ‚Äî Learner", x: 400, y: 220 },
      { id: "soul", label: "Soul Engine üåø", type: "agent", trust: 0.84, scope: "Observe, reflect, encourage", jurisdiction: "NZ-BOP", x: 250, y: 340 },
      { id: "progress", label: "Progress Tracker", type: "agent", trust: 0.80, scope: "Anonymised progress only", jurisdiction: "NZ-BOP", x: 550, y: 340 },
      { id: "funder", label: "Funding Report Agent", type: "agent", trust: 0.72, scope: "Aggregate stats ONLY", jurisdiction: "NZ-WGN", x: 550, y: 460 },
      { id: "blocked", label: "‚õî Raw Video Export", type: "blocked", trust: 0, scope: "BLOCKED ‚Äî Cultural content stays within whƒÅnau", jurisdiction: "NZ-BOP", x: 250, y: 460 },
    ],
    edges: [["kaumatua","rangatahi"],["kaiako","rangatahi"],["whanau","rangatahi"],["rangatahi","soul"],["rangatahi","progress"],["progress","funder"],["soul","blocked"]],
    events: [
      { time: 0, type: "verify", node: "kaumatua", message: "Mere (KaumƒÅtua) verified ‚úì ‚Äî Cultural authority established" },
      { time: 800, type: "verify", node: "kaiako", message: "Hemi (Kaiako) verified ‚úì ‚Äî Teaching authority confirmed" },
      { time: 1600, type: "verify", node: "whanau", message: "WhƒÅnau representative verified ‚úì ‚Äî Oversight role active" },
      { time: 2400, type: "verify", node: "rangatahi", message: "üìπ Aroha begins kapa haka practice ‚Äî Video IS biometric verification" },
      { time: 3200, type: "create", node: "rangatahi", message: "VAT created ‚Äî Recording anchored to Aroha's identity. Cultural content scope: whƒÅnau only" },
      { time: 4200, type: "delegate", node: "soul", message: "üåø Soul Engine activated ‚Äî Observing movement, expression, wairua" },
      { time: 5400, type: "action", node: "soul", message: "üåø Soul reflection: 'Your p≈´kana is getting stronger ‚Äî the mana is showing through'" },
      { time: 6400, type: "action", node: "soul", message: "üåø Soul reflection: 'Notice how your feet connect to the whenua now ‚Äî that wasn't there last week'" },
      { time: 7200, type: "delegate", node: "progress", message: "Progress tracked ‚Äî Session 14 of 20, confidence +12%, posture +8%" },
      { time: 8000, type: "delegate", node: "funder", message: "Funding report: Aggregate only ‚Äî '14 rangatahi active, 73% improvement in cultural competency metrics'" },
      { time: 9000, type: "blocked", node: "blocked", message: "üõë External request for raw practice video ‚Äî BLOCKED. KaumƒÅtua scope: cultural content stays within whƒÅnau" },
      { time: 10000, type: "provenance", node: "rangatahi", message: "üìã Complete provenance: Every reflection traceable to Aroha's session. Every scope decision traceable to kaumƒÅtua authority." },
    ],
  },
};

// Interactive decision trees for consortium scenario
const CONSORTIUM_BRANCHES = {
  resign: {
    label: "Member Resigns",
    desc: "Voluntary withdrawal",
    color: "#FFC107",
    icon: "üö™",
    events: [
      { type: "warning", node: "m3", message: "‚ö† Member 3 voluntarily withdrawing consent..." },
      { type: "revoke_one", node: "m3", message: "üö™ Member 3 WITHDRAWN ‚Äî biometric consent revoked" },
      { type: "quorum", node: "cvat", message: "üìä Quorum re-evaluation: 6/7 remaining ‚Äî Threshold 5/7 ‚Äî STILL VALID ‚úì" },
      { type: "action", node: "coord", message: "‚úì Operation CONTINUES with reduced consortium (6/7)" },
      { type: "provenance", node: "cvat", message: "üìã Provenance: Voluntary withdrawal recorded. Classification: CLEAN." },
    ],
  },
  fired: {
    label: "Member Fired",
    desc: "Organisational revocation",
    color: "#FF9800",
    icon: "üî®",
    events: [
      { type: "warning", node: "m3", message: "‚ö† Member 3's organisation revoking authority ‚Äî TERMINATION" },
      { type: "alert", node: "m3", message: "üîç Dual check: Biometric ‚úì (still active) | Org Role ‚úó (TERMINATED)" },
      { type: "revoke_one", node: "m3", message: "üî® Member 3 REMOVED ‚Äî biometric valid but role revoked" },
      { type: "quorum", node: "cvat", message: "üìä Quorum re-evaluation: 6/7 remaining ‚Äî Threshold 5/7 ‚Äî STILL VALID ‚úì" },
      { type: "action", node: "coord", message: "‚úì Operation CONTINUES ‚Äî org revocation does not affect other members" },
      { type: "provenance", node: "cvat", message: "üìã Provenance: Org revocation recorded. Biometric session orphaned." },
    ],
  },
  compromised: {
    label: "Member Compromised",
    desc: "Security incident",
    color: "#F44336",
    icon: "üî¥",
    events: [
      { type: "alert", node: "m3", message: "üö® SECURITY ALERT: Member 3 session suspected compromised!" },
      { type: "revoke_one", node: "m3", message: "üî¥ Member 3 EMERGENCY REVOKED ‚Äî zero grace period" },
      { type: "alert", node: "cvat", message: "üîç FORENSIC FLAG: All actions via Member 3's contribution under review" },
      { type: "quorum", node: "cvat", message: "üìä Quorum re-evaluation: 6/7 remaining ‚Äî Threshold 5/7 ‚Äî STILL VALID ‚úì" },
      { type: "action", node: "coord", message: "‚úì Operation CONTINUES ‚Äî enhanced monitoring activated" },
      { type: "provenance", node: "cvat", message: "üìã Provenance: Security compromise. Forensic flags on all dependent actions." },
    ],
  },
  timeout: {
    label: "Member Lost",
    desc: "Connection/incapacitation",
    color: "#9E9E9E",
    icon: "üì°",
    events: [
      { type: "warning", node: "m3", message: "üì° Member 3 re-verification pending... connection lost" },
      { type: "waiting", node: "m3", message: "‚è≥ Trust decay: 0.90 ‚Üí 0.72 ‚Üí 0.54 ‚Üí threshold..." },
      { type: "alert", node: "m3", message: "‚è∞ Grace period expired (120s) ‚Äî Member 3 contribution LAPSED" },
      { type: "revoke_one", node: "m3", message: "üì° Member 3 TIMED OUT ‚Äî gradual trust decay, not sudden revocation" },
      { type: "quorum", node: "cvat", message: "üìä Quorum re-evaluation: 6/7 remaining ‚Äî Threshold 5/7 ‚Äî STILL VALID ‚úì" },
      { type: "action", node: "coord", message: "‚úì Operation CONTINUES ‚Äî timeout recorded, not compromised" },
    ],
  },
};

const CASCADE_EVENTS = [
  { type: "warning", node: "m5", message: "‚ö† Member 5 also losing authority..." },
  { type: "revoke_one", node: "m5", message: "‚ùå Member 5 REVOKED ‚Äî Quorum dropping..." },
  { type: "cascade", node: "cvat", message: "üî¥ QUORUM CHECK: 5/7 remaining ‚Äî Threshold 5/7 ‚Äî CRITICAL" },
  { type: "warning", node: "m4", message: "‚ö† Member 4 withdrawing..." },
  { type: "revoke_one", node: "m4", message: "‚ùå Member 4 REVOKED" },
  { type: "cascade", node: "cvat", message: "üí• QUORUM LOST: 4/7 remaining ‚Äî Threshold 5/7 ‚Äî BELOW MINIMUM" },
  { type: "cascade", node: "cvat", message: "üõë COLLECTIVE VAT INVALIDATED ‚Äî CASCADE TO ALL AGENTS" },
  { type: "cascade", node: "coord", message: "üõë Swarm Coordinator ‚Üí SUSPENDED" },
  { type: "cascade", node: "sw_a", message: "üõë Drones 1-10 ‚Üí SAFE STATE (hover at current position)" },
  { type: "cascade", node: "sw_b", message: "üõë Drones 11-20 ‚Üí SAFE STATE (hover at current position)" },
  { type: "cascade", node: "sw_c", message: "üõë Drones 21-30 ‚Üí SAFE STATE (hover at current position)" },
  { type: "cascade", node: "sw_d", message: "üõë Drones 31-40 ‚Üí SAFE STATE (hover at current position)" },
  { type: "provenance", node: "cvat", message: "üì∏ Forensic snapshot: 40 drones ‚Äî position, altitude, speed, heading, fuel captured" },
  { type: "provenance", node: "cvat", message: "üìã Provenance gap opened: Operation suspended ‚Äî awaiting reconstitution" },
];

const KAUMATUA_CASCADE_EVENTS = [
  { type: "warning", node: "m7", message: "‚ö† KaumƒÅtua (Member 7) withdrawing authority..." },
  { type: "revoke_one", node: "m7", message: "‚ùå KaumƒÅtua WITHDRAWN" },
  { type: "cascade", node: "cvat", message: "üìä Quorum check: 5/7 remaining ‚Äî Threshold 5/7 ‚Äî ABOVE QUORUM..." },
  { type: "cascade", node: "cvat", message: "üî¥ BUT: MANDATORY ROLE ABSENT ‚Äî KaumƒÅtua verification REQUIRED" },
  { type: "cascade", node: "cvat", message: "üí• COLLECTIVE VAT INVALIDATED ‚Äî Mandatory role overrides quorum numbers" },
  { type: "cascade", node: "coord", message: "üõë Swarm Coordinator ‚Üí SUSPENDED" },
  { type: "cascade", node: "sw_a", message: "üõë Drones 1-10 ‚Üí SAFE STATE" },
  { type: "cascade", node: "sw_b", message: "üõë Drones 11-20 ‚Üí SAFE STATE" },
  { type: "cascade", node: "sw_c", message: "üõë Drones 21-30 ‚Üí SAFE STATE" },
  { type: "cascade", node: "sw_d", message: "üõë Drones 31-40 ‚Üí SAFE STATE" },
  { type: "provenance", node: "cvat", message: "üì∏ Forensic snapshot: 40 drones state captured" },
  { type: "provenance", node: "cvat", message: "üìã Cascade cause: MANDATORY ROLE LOSS (not quorum). Numbers don't override governance." },
];

const RECONSTITUTE_EVENTS = [
  { type: "action", node: "cvat", message: "üîÑ Reconstitution initiated ‚Äî remaining members reconvening..." },
  { type: "verify", node: "m1", message: "Member 1 (Chair) re-verified ‚úì" },
  { type: "verify", node: "m2", message: "Member 2 re-verified ‚úì" },
  { type: "verify", node: "m6", message: "Member 6 re-verified ‚úì" },
  { type: "verify", node: "m7", message: "KaumƒÅtua re-verified ‚úì ‚Äî Mandatory role present" },
  { type: "action", node: "cvat", message: "üë§ NEW: Member 8 appointed to replace ‚Äî biometric verification..." },
  { type: "verify", node: "m3", message: "Member 8 (replacement) verified ‚úì ‚Äî Quorum: 5/5 of reconstituted body" },
  { type: "create", node: "cvat", message: "‚ú¶ NEW Collective VAT issued ‚Äî Reconstituted consortium (5 members)" },
  { type: "delegate", node: "coord", message: "Swarm Coordinator RE-AUTHORISED" },
  { type: "action", node: "sw_a", message: "‚úà Drones 1-10 RESUMING from safe state positions" },
  { type: "action", node: "sw_b", message: "‚úà Drones 11-20 RESUMING" },
  { type: "action", node: "sw_c", message: "‚úà Drones 21-30 RESUMING" },
  { type: "action", node: "sw_d", message: "‚úà Drones 31-40 RESUMING" },
  { type: "provenance", node: "cvat", message: "üìã Provenance gap CLOSED: Suspended ‚Üí Reconstituted. Gap is permanent record." },
  { type: "action", node: "coord", message: "‚úÖ Survey mission resumed ‚Äî 40 drones operational under new authority chain" },
];

const NODE_STYLES = {
  human: { fill: "#1B3A5C", stroke: "#2E75B6", icon: "üë§", radius: 32 },
  agent: { fill: "#2C3E50", stroke: "#5DADE2", icon: "ü§ñ", radius: 24 },
  governance: { fill: "#1B5E20", stroke: "#66BB6A", icon: "üë§", radius: 22 },
  kaumatua: { fill: "#4A0E4E", stroke: "#CE93D8", icon: "üë§", radius: 26 },
  collective: { fill: "#E65100", stroke: "#FFB74D", icon: "‚ú¶", radius: 28 },
  physical: { fill: "#37474F", stroke: "#78909C", icon: "‚úà", radius: 22 },
  blocked: { fill: "#B71C1C", stroke: "#EF5350", icon: "‚õî", radius: 22 },
  rahui: { fill: "#0077B6", stroke: "#48CAE4", icon: "üåä", radius: 28 },
  tapu: { fill: "#7B0000", stroke: "#FF4444", icon: "üî¥", radius: 28 },
};

function TrustGraph({ scenario, activeNodes, revokedNodes, blockedNodes, safeStateNodes, quorumText }) {
  const canvasRef = useRef(null);
  const sc = SCENARIOS[scenario];

  useEffect(() => {
    const canvas = canvasRef.current;
    if (!canvas) return;
    const ctx = canvas.getContext("2d");
    const dpr = window.devicePixelRatio || 1;
    canvas.width = 800 * dpr;
    canvas.height = 500 * dpr;
    ctx.scale(dpr, dpr);
    ctx.clearRect(0, 0, 800, 500);

    // Draw edges
    sc.edges.forEach(([from, to]) => {
      const fn = sc.nodes.find(n => n.id === from);
      const tn = sc.nodes.find(n => n.id === to);
      if (!fn || !tn) return;
      const isActive = activeNodes.has(from) && activeNodes.has(to);
      const isRevoked = revokedNodes.has(from) || revokedNodes.has(to);
      const isSafe = safeStateNodes.has(to);
      ctx.beginPath();
      ctx.moveTo(fn.x, fn.y);
      ctx.lineTo(tn.x, tn.y);
      ctx.strokeStyle = isSafe ? "#2196F388" : isRevoked ? "#EF535088" : isActive ? `${sc.color}88` : "#333333";
      ctx.lineWidth = isRevoked ? 3 : isActive ? 2.5 : 1;
      if (isRevoked || isSafe) ctx.setLineDash([6, 4]);
      else ctx.setLineDash([]);
      ctx.stroke();
      ctx.setLineDash([]);

      const angle = Math.atan2(tn.y - fn.y, tn.x - fn.x);
      const tr = NODE_STYLES[tn.type]?.radius || 24;
      const ax = tn.x - Math.cos(angle) * (tr + 6);
      const ay = tn.y - Math.sin(angle) * (tr + 6);
      ctx.beginPath();
      ctx.moveTo(ax, ay);
      ctx.lineTo(ax - 10 * Math.cos(angle - 0.3), ay - 10 * Math.sin(angle - 0.3));
      ctx.lineTo(ax - 10 * Math.cos(angle + 0.3), ay - 10 * Math.sin(angle + 0.3));
      ctx.closePath();
      ctx.fillStyle = isSafe ? "#2196F3" : isRevoked ? "#EF5350" : isActive ? sc.color : "#555";
      ctx.fill();
    });

    // Draw nodes
    sc.nodes.forEach(node => {
      const style = NODE_STYLES[node.type] || NODE_STYLES.agent;
      const isActive = activeNodes.has(node.id);
      const isRevoked = revokedNodes.has(node.id);
      const isBlocked = blockedNodes.has(node.id);
      const isSafe = safeStateNodes.has(node.id);

      if (isActive && !isRevoked && !isBlocked && !isSafe) {
        ctx.beginPath();
        ctx.arc(node.x, node.y, style.radius + 8, 0, Math.PI * 2);
        const grad = ctx.createRadialGradient(node.x, node.y, style.radius, node.x, node.y, style.radius + 12);
        grad.addColorStop(0, `${style.stroke}44`);
        grad.addColorStop(1, "transparent");
        ctx.fillStyle = grad;
        ctx.fill();
      }

      if (isRevoked) {
        ctx.beginPath();
        ctx.arc(node.x, node.y, style.radius + 10, 0, Math.PI * 2);
        ctx.strokeStyle = "#EF535066";
        ctx.lineWidth = 3;
        ctx.stroke();
      }

      if (isSafe) {
        ctx.beginPath();
        ctx.arc(node.x, node.y, style.radius + 10, 0, Math.PI * 2);
        ctx.strokeStyle = "#2196F366";
        ctx.lineWidth = 3;
        ctx.stroke();
      }

      ctx.beginPath();
      ctx.arc(node.x, node.y, style.radius, 0, Math.PI * 2);
      ctx.fillStyle = isSafe ? "#0D47A1" : isRevoked ? "#B71C1C" : isBlocked ? "#4A0000" : isActive ? style.fill : "#1a1a1a";
      ctx.fill();
      ctx.strokeStyle = isSafe ? "#2196F3" : isRevoked ? "#EF5350" : isBlocked ? "#FF4444" : isActive ? style.stroke : "#444";
      ctx.lineWidth = isActive ? 2.5 : 1.5;
      ctx.stroke();

      ctx.font = `${style.radius * 0.65}px serif`;
      ctx.textAlign = "center";
      ctx.textBaseline = "middle";
      ctx.fillStyle = "white";
      ctx.fillText(isSafe ? "üîµ" : style.icon, node.x, node.y);

      ctx.font = "bold 10px 'SF Mono', 'Fira Code', monospace";
      ctx.textAlign = "center";
      ctx.fillStyle = isSafe ? "#2196F3" : isRevoked ? "#EF5350" : isActive ? "#E0E0E0" : "#666";
      ctx.fillText(node.label, node.x, node.y + style.radius + 14);

      if (node.trust > 0 && isActive) {
        ctx.font = "bold 9px monospace";
        ctx.fillStyle = isSafe ? "#2196F3" : isRevoked ? "#EF5350" : "#4CAF50";
        const badge = isSafe ? "SAFE STATE" : isRevoked ? "REVOKED" : `T:${node.trust.toFixed(2)}`;
        ctx.fillText(badge, node.x, node.y + style.radius + 26);
      }
    });

    // Quorum display for consortium
    if (quorumText && scenario === "consortium") {
      ctx.font = "bold 13px monospace";
      ctx.textAlign = "center";
      const isLost = quorumText.includes("LOST") || quorumText.includes("ABSENT");
      ctx.fillStyle = isLost ? "#EF5350" : "#4CAF50";
      ctx.fillText(quorumText, 400, 155);
    }
  }, [scenario, activeNodes, revokedNodes, blockedNodes, safeStateNodes, quorumText]);

  return <canvas ref={canvasRef} style={{ width: 800, height: 500, borderRadius: 8 }} />;
}

function MetricsPanel({ metrics }) {
  return (
    <div style={{ display: "grid", gridTemplateColumns: "repeat(3, 1fr)", gap: 8, marginTop: 12 }}>
      {Object.entries(metrics).map(([key, val]) => (
        <div key={key} style={{ background: "#111", borderRadius: 6, padding: "8px 12px", borderLeft: `3px solid ${val.color || "#555"}` }}>
          <div style={{ fontSize: 10, color: "#888", fontFamily: "monospace", letterSpacing: 1 }}>{key}</div>
          <div style={{ fontSize: 18, fontWeight: 700, color: val.color || "#ccc", fontFamily: "monospace" }}>{val.value}</div>
          <div style={{ fontSize: 9, color: "#666" }}>{val.label}</div>
        </div>
      ))}
    </div>
  );
}

function VACSimulation() {
  const [scenario, setScenario] = useState("wananga");
  const [running, setRunning] = useState(false);
  const [activeNodes, setActiveNodes] = useState(new Set());
  const [revokedNodes, setRevokedNodes] = useState(new Set());
  const [blockedNodes, setBlockedNodes] = useState(new Set());
  const [safeStateNodes, setSafeStateNodes] = useState(new Set());
  const [log, setLog] = useState([]);
  const [metrics, setMetrics] = useState({});
  const [phase, setPhase] = useState("idle");
  const [quorumText, setQuorumText] = useState("");
  const [currentBeat, setCurrentBeat] = useState(-1);
  const [showVATExplainer, setShowVATExplainer] = useState(false);
  const [showSDKExplainer, setShowSDKExplainer] = useState(false);
  const [showTrustGraph, setShowTrustGraph] = useState(false);
  const [playMode, setPlayMode] = useState("auto"); // "auto" or "step"
  const stepIdxRef = useRef(-1);
  const [stepDisplay, setStepDisplay] = useState(-1);
  const timerRef = useRef(null);
  const logEndRef = useRef(null);

  const sc = SCENARIOS[scenario];

  const reset = useCallback(() => {
    clearTimeout(timerRef.current);
    setRunning(false);
    setPhase("idle");
    setActiveNodes(new Set());
    setRevokedNodes(new Set());
    setBlockedNodes(new Set());
    setSafeStateNodes(new Set());
    setLog([]);
    setQuorumText("");
    setCurrentBeat(-1);
    stepIdxRef.current = -1;
    setStepDisplay(-1);
    setMetrics({
      VATV: { value: "‚Äî", label: "Verification Time", color: "#555" },
      RPL: { value: "‚Äî", label: "Revocation Propagation", color: "#555" },
      SNER: { value: "100%", label: "Scope Narrowing Rate", color: "#4CAF50" },
      QUORUM: { value: "‚Äî", label: "Quorum Status", color: "#555" },
      DRONES: { value: "0", label: "Active Drones", color: "#555" },
      NODES: { value: "0", label: "Active Agents", color: "#555" },
    });
  }, []);

  useEffect(() => { reset(); }, [scenario, reset]);
  useEffect(() => {
    if (logEndRef.current) logEndRef.current.scrollIntoView({ behavior: "smooth" });
  }, [log]);

  const playEvents = (events, onComplete, delay = 800) => {
    let idx = 0;
    const processNext = () => {
      if (idx >= events.length) { if (onComplete) onComplete(); return; }
      const evt = events[idx];
      setLog(prev => [...prev, { time: new Date().toLocaleTimeString(), type: evt.type, message: evt.message }]);
      if (sc.story && sc.story.beats) {
        const matchingBeat = sc.story.beats.filter(b => b.at <= idx);
        if (matchingBeat.length > 0) setCurrentBeat(matchingBeat.length - 1);
      }

      if (evt.type === "verify" || evt.type === "create" || evt.type === "delegate" || evt.type === "action" || evt.type === "provenance" || evt.type === "waiting") {
        setActiveNodes(prev => new Set([...prev, evt.node]));
      }
      if (evt.type === "revoke_one") {
        setRevokedNodes(prev => new Set([...prev, evt.node]));
      }
      if (evt.type === "cascade") {
        if (["sw_a","sw_b","sw_c","sw_d"].includes(evt.node)) {
          setSafeStateNodes(prev => new Set([...prev, evt.node]));
        }
        if (["coord","cvat"].includes(evt.node)) {
          setRevokedNodes(prev => new Set([...prev, evt.node]));
        }
      }
      if (evt.type === "revoke") {
        setRevokedNodes(new Set(sc.nodes.map(n => n.id)));
      }
      if (evt.type === "blocked" || evt.type === "alert") {
        setBlockedNodes(prev => new Set([...prev, evt.node]));
        setActiveNodes(prev => new Set([...prev, evt.node]));
      }
      if (evt.type === "quorum") {
        const match = evt.message.match(/(\d+\/\d+)/);
        if (match) {
          setQuorumText(`Quorum: ${match[1]} (threshold: 5/7)`);
          const [num] = match[1].split("/").map(Number);
          setMetrics(prev => ({
            ...prev,
            QUORUM: { value: match[1], label: num >= 5 ? "Quorum VALID" : "QUORUM LOST", color: num >= 5 ? "#4CAF50" : "#EF5350" },
          }));
        }
      }

      // Metrics updates
      const activeCount = idx + 1;
      setMetrics(prev => ({
        ...prev,
        VATV: { value: `${(Math.random() * 3 + 1).toFixed(1)}ms`, label: "Verification Time", color: "#4CAF50" },
        NODES: { value: `${Math.min(activeCount, sc.nodes.length)}`, label: "Active Agents", color: "#2E75B6" },
      }));

      idx++;
      timerRef.current = setTimeout(processNext, delay);
    };
    processNext();
  };

  // Process a single event at a given index
  const processEventAtIndex = useCallback((idx) => {
    const events = sc.events;
    if (idx >= events.length) return;
    const evt = events[idx];
    setLog(prev => [...prev, { time: new Date().toLocaleTimeString(), type: evt.type, message: evt.message }]);
    // Advance narrative beat - find the latest beat at or before this event index
    if (sc.story && sc.story.beats) {
      let bestBeat = -1;
      for (let b = 0; b < sc.story.beats.length; b++) {
        if (sc.story.beats[b].at <= idx) bestBeat = b;
      }
      if (bestBeat >= 0) setCurrentBeat(bestBeat);
    }
    if (evt.type === "verify" || evt.type === "create" || evt.type === "delegate" || evt.type === "action" || evt.type === "provenance" || evt.type === "waiting") {
      setActiveNodes(prev => new Set([...prev, evt.node]));
      setMetrics(prev => ({
        ...prev,
        VATV: { value: `${(Math.random() * 3 + 1).toFixed(1)}ms`, label: "Verification Time", color: "#4CAF50" },
        NODES: { value: `${Math.min(idx + 1, sc.nodes.length)}`, label: "Active Agents", color: "#2E75B6" },
        SNER: { value: "100%", label: "Scope Narrowing Rate", color: "#4CAF50" },
      }));
    }
    if (evt.type === "revoke") {
      setRevokedNodes(new Set(sc.nodes.map(n => n.id)));
      setMetrics(prev => ({
        ...prev,
        RPL: { value: `${(Math.random() * 400 + 200).toFixed(0)}ms`, label: "Revocation Propagation", color: "#EF5350" },
        NODES: { value: "0", label: "Active Agents (REVOKED)", color: "#EF5350" },
      }));
    }
    if (evt.type === "blocked" || evt.type === "alert") {
      setBlockedNodes(prev => new Set([...prev, evt.node]));
      setActiveNodes(prev => new Set([...prev, evt.node]));
    }
  }, [sc]);

  const stepForward = () => {
    const nextIdx = stepIdxRef.current + 1;
    if (nextIdx >= sc.events.length) {
      setPhase("complete");
      setRunning(false);
      return;
    }
    if (nextIdx === 0) {
      reset();
      setRunning(true);
      setPhase("running");
    }
    stepIdxRef.current = nextIdx;
    setStepDisplay(nextIdx);
    processEventAtIndex(nextIdx);
  };

  const runScenario = () => {
    reset();
    setRunning(true);
    setPhase("running");

    if (playMode === "step") {
      // Step mode: process first event, then wait for user
      stepIdxRef.current = 0;
      setStepDisplay(0);
      processEventAtIndex(0);
      return;
    }

    if (sc.interactive) {
      playEvents(sc.events, () => {
        setPhase("choose_crisis");
        setQuorumText("Quorum: 7/7 (threshold: 5/7)");
        setMetrics(prev => ({
          ...prev,
          QUORUM: { value: "7/7", label: "Quorum VALID", color: "#4CAF50" },
          DRONES: { value: "40", label: "Active Drones", color: "#4CAF50" },
        }));
      });
    } else {
      const events = sc.events;
      let idx = 0;
      const processNext = () => {
        if (idx >= events.length) { setRunning(false); setPhase("complete"); return; }
        processEventAtIndex(idx);
        idx++;
        const nextEvt = idx < events.length ? events[idx] : null;
        const prevEvt = events[idx - 1];
        const nextDelay = nextEvt ? nextEvt.time - prevEvt.time : 0;
        timerRef.current = setTimeout(processNext, Math.max(nextDelay, 800));
      };
      processNext();
    }
  };

  const handleCrisisChoice = (choice) => {
    setPhase("crisis_playing");
    const branch = CONSORTIUM_BRANCHES[choice];
    setLog(prev => [...prev, { time: "‚Äî‚Äî‚Äî", type: "action", message: `${branch.icon} CRISIS: ${branch.label} ‚Äî ${branch.desc}` }]);
    playEvents(branch.events, () => {
      setQuorumText("Quorum: 6/7 (threshold: 5/7)");
      setMetrics(prev => ({
        ...prev,
        QUORUM: { value: "6/7", label: "Quorum VALID (reduced)", color: "#FFC107" },
      }));
      setPhase("choose_escalate");
    });
  };

  const handleEscalate = (type) => {
    setPhase("escalating");
    const events = type === "kaumatua" ? KAUMATUA_CASCADE_EVENTS : CASCADE_EVENTS;
    setLog(prev => [...prev, { time: "‚Äî‚Äî‚Äî", type: "cascade", message: type === "kaumatua" ? "üèõ MANDATORY ROLE TEST: What if the kaumƒÅtua withdraws?" : "üí• ESCALATION: More members lose authority..." }]);
    playEvents(events, () => {
      setQuorumText(type === "kaumatua" ? "MANDATORY ROLE ABSENT ‚Äî CASCADE" : "QUORUM LOST: 4/7 < 5/7 ‚Äî CASCADE");
      setMetrics(prev => ({
        ...prev,
        QUORUM: { value: type === "kaumatua" ? "5/7*" : "4/7", label: type === "kaumatua" ? "MANDATORY ROLE ABSENT" : "QUORUM LOST", color: "#EF5350" },
        RPL: { value: `${(Math.random() * 400 + 400).toFixed(0)}ms`, label: "Cascade-to-Safe-State", color: "#EF5350" },
        DRONES: { value: "0 (safe)", label: "Drones in SAFE STATE", color: "#2196F3" },
      }));
      setPhase("cascaded");
    }, 600);
  };

  const handleReconstitute = () => {
    setPhase("reconstituting");
    // Reset some visual state
    setRevokedNodes(prev => {
      const n = new Set(prev);
      n.delete("cvat"); n.delete("coord");
      return n;
    });
    setSafeStateNodes(new Set());
    setLog(prev => [...prev, { time: "‚Äî‚Äî‚Äî", type: "action", message: "üîÑ RECONSTITUTION: Remaining members reconvening..." }]);
    playEvents(RECONSTITUTE_EVENTS, () => {
      setQuorumText("Quorum: 5/5 RECONSTITUTED ‚úì");
      setMetrics(prev => ({
        ...prev,
        QUORUM: { value: "5/5 ‚úì", label: "Reconstituted", color: "#4CAF50" },
        DRONES: { value: "40", label: "Drones RESUMED", color: "#4CAF50" },
        RPL: { value: prev.RPL.value, label: "Cascade-to-Safe-State", color: "#4CAF50" },
      }));
      setPhase("complete");
    });
  };

  const eventColors = {
    verify: "#4CAF50", create: "#2E75B6", delegate: "#5DADE2", action: "#66BB6A",
    revoke: "#EF5350", revoke_one: "#FF9800", blocked: "#FF4444", alert: "#FFB74D",
    provenance: "#CE93D8", waiting: "#FFC107", cascade: "#EF5350", warning: "#FF9800",
    quorum: "#2196F3",
  };

  return (
    <div style={{ minHeight: "100vh", background: "#0a0a0a", color: "#e0e0e0", fontFamily: "'SF Mono', 'Fira Code', 'JetBrains Mono', monospace", padding: 0 }}>
      {/* Header */}
      <div style={{ background: "linear-gradient(135deg, #0d1117 0%, #1B3A5C 100%)", padding: "20px 24px 16px", borderBottom: "1px solid #222" }}>
        <div style={{ display: "flex", alignItems: "center", justifyContent: "space-between", maxWidth: 1200, margin: "0 auto" }}>
          <div>
            <div style={{ fontSize: 11, letterSpacing: 3, color: "#888", marginBottom: 4 }}>VAC PROTOCOL</div>
            <div style={{ fontSize: 22, fontWeight: 700, color: "#fff", letterSpacing: -0.5 }}>Trust Chain Simulation</div>
            <div style={{ fontSize: 11, color: "#666", marginTop: 2 }}>241 Claims ¬∑ 38 Sections ¬∑ 4 Filings ¬∑ vacprotocol.org</div>
          </div>
          <div style={{ textAlign: "right" }}>
            <div style={{ fontSize: 10, color: "#888" }}>PATENT: AU 2026901425</div>
            <div style={{ fontSize: 10, color: "#666" }}>Violet Shores Pty Ltd</div>
            <button onClick={() => setShowSDKExplainer(!showSDKExplainer)}
              style={{ marginTop: 6, padding: "4px 10px", background: showSDKExplainer ? "#4CAF5022" : "transparent", border: showSDKExplainer ? "1px solid #4CAF50" : "1px solid #444", borderRadius: 4, color: showSDKExplainer ? "#4CAF50" : "#888", cursor: "pointer", fontSize: 9, fontFamily: "inherit", letterSpacing: 1 }}>
              ‚ö° POWERED BY VAC SDK
            </button>
          </div>
        </div>
      </div>

      <div style={{ maxWidth: 1200, margin: "0 auto", padding: "16px 24px" }}>

        {/* VAC SDK Explainer */}
        {showSDKExplainer && (
          <div style={{ marginBottom: 16, padding: "20px 24px", background: "#0a1a0a", borderRadius: 8, border: "1px solid #2D5A27", fontFamily: "-apple-system, 'Segoe UI', sans-serif" }}>
            <div style={{ display: "flex", justifyContent: "space-between", alignItems: "flex-start" }}>
              <div>
                <div style={{ fontSize: 16, fontWeight: 700, color: "#4CAF50", marginBottom: 4 }}>VAC SDK ‚Äî The Identity Engine Inside Your App</div>
                <div style={{ fontSize: 11, color: "#666", fontFamily: "'Courier New', monospace" }}>@vac-auth/sdk ¬∑ npm package ¬∑ one line of code to integrate</div>
              </div>
              <button onClick={() => setShowSDKExplainer(false)} style={{ background: "none", border: "none", color: "#666", cursor: "pointer", fontSize: 16 }}>‚úï</button>
            </div>

            <div style={{ fontSize: 13, color: "#ccc", lineHeight: 1.8, marginTop: 14, maxWidth: 800 }}>
              VAC is not an app. It's an <strong style={{ color: "#4CAF50" }}>SDK</strong> ‚Äî a software development kit that any app can embed. FolioAI uses it. Any education platform, healthcare app, or enterprise tool can use it. The app provides the user experience; the VAC SDK provides the identity layer underneath.
            </div>

            <div style={{ fontSize: 13, color: "#aaa", lineHeight: 1.8, marginTop: 10, maxWidth: 800 }}>
              When a user records a video in FolioAI, they don't see VAC. They don't know it's there. But the SDK is capturing five biometric signals from that single recording ‚Äî face, voice, behavioural patterns, location, and timing ‚Äî and fusing them into a composite trust score that's exponentially harder to fake than any single factor.
            </div>

            <div style={{ display: "grid", gridTemplateColumns: "1fr 1fr 1fr", gap: 12, marginTop: 16 }}>
              <div style={{ padding: "12px 14px", background: "#111", borderRadius: 6, borderTop: "3px solid #4CAF50" }}>
                <div style={{ fontSize: 12, fontWeight: 700, color: "#4CAF50", marginBottom: 6 }}>What It Does</div>
                <div style={{ fontSize: 12, color: "#aaa", lineHeight: 1.6 }}>Captures 5 biometric modalities from a single video recording. Creates a Verified Authority Token (VAT) anchored to that person's unique biometric signature. No passwords. No OTPs. Just the person.</div>
              </div>
              <div style={{ padding: "12px 14px", background: "#111", borderRadius: 6, borderTop: "3px solid #5DADE2" }}>
                <div style={{ fontSize: 12, fontWeight: 700, color: "#5DADE2", marginBottom: 6 }}>Why It's Unique</div>
                <div style={{ fontSize: 12, color: "#aaa", lineHeight: 1.6 }}>No other SDK combines face + voice + behaviour + location + temporal signals into one trust score. Auth0 does passwords. iProov does face only. Nuance does voice only. VAC does all five ‚Äî and the combination is patented.</div>
              </div>
              <div style={{ padding: "12px 14px", background: "#111", borderRadius: 6, borderTop: "3px solid #FFB74D" }}>
                <div style={{ fontSize: 12, fontWeight: 700, color: "#FFB74D", marginBottom: 6 }}>How Apps Use It</div>
                <div style={{ fontSize: 12, color: "#aaa", lineHeight: 1.6 }}>One SDK import. The app calls VAC when it needs identity ‚Äî during onboarding, before sensitive actions, or continuously in the background. The user just uses the app normally. VAC is invisible.</div>
              </div>
            </div>

            <div style={{ marginTop: 14, padding: "10px 14px", background: "#111", borderRadius: 6, display: "flex", gap: 20, alignItems: "center" }}>
              <div style={{ fontSize: 11, color: "#888" }}>
                <strong style={{ color: "#ccc" }}>FolioAI</strong> is the first app powered by the VAC SDK. The practice recording that helps you grow IS the biometric verification that proves it's you. One action, two outcomes. That's the design principle: security embedded in the experience, not bolted on.
              </div>
            </div>
          </div>
        )}

        {/* Scenario Tabs */}
        <div style={{ display: "flex", gap: 6, marginBottom: 16, flexWrap: "wrap" }}>
          {Object.entries(SCENARIOS).map(([key, s]) => (
            <button key={key} onClick={() => setScenario(key)}
              style={{ padding: "8px 14px", border: scenario === key ? `2px solid ${s.color}` : "1px solid #333", borderRadius: 6, background: scenario === key ? `${s.color}22` : "#111", color: scenario === key ? s.color : "#888", cursor: "pointer", fontSize: 11, fontFamily: "inherit", fontWeight: scenario === key ? 700 : 400, transition: "all 0.2s" }}>
              {s.title}
            </button>
          ))}
        </div>

        {/* Story Panel */}
        <div style={{ marginBottom: 12, borderRadius: 8, overflow: "hidden", border: `1px solid ${sc.color}33` }}>
          {/* Title bar with Run button */}
          <div style={{ display: "flex", justifyContent: "space-between", alignItems: "center", padding: "12px 16px", background: "#111", borderBottom: `1px solid ${sc.color}22` }}>
            <div>
              <div style={{ fontSize: 18, fontWeight: 700, color: sc.color, fontFamily: "-apple-system, 'Segoe UI', sans-serif" }}>{sc.title}</div>
              <div style={{ fontSize: 12, color: "#888", fontFamily: "-apple-system, 'Segoe UI', sans-serif" }}>{sc.subtitle}</div>
            </div>
            <div style={{ display: "flex", gap: 8, alignItems: "center" }}>
              <button onClick={() => setShowVATExplainer(!showVATExplainer)}
                style={{ padding: "8px 14px", background: showVATExplainer ? "#2E75B622" : "#1a1a1a", border: showVATExplainer ? "1px solid #2E75B6" : "1px solid #333", borderRadius: 6, color: showVATExplainer ? "#2E75B6" : "#888", cursor: "pointer", fontSize: 10, fontFamily: "inherit" }}>
                {showVATExplainer ? "‚úï Close" : "‚Ñπ What is a VAT Token?"}
              </button>
              <button onClick={() => setShowTrustGraph(!showTrustGraph)}
                style={{ padding: "8px 14px", background: showTrustGraph ? "#CE93D822" : "#1a1a1a", border: showTrustGraph ? "1px solid #CE93D8" : "1px solid #333", borderRadius: 6, color: showTrustGraph ? "#CE93D8" : "#888", cursor: "pointer", fontSize: 10, fontFamily: "inherit" }}>
                {showTrustGraph ? "‚úï Close" : "üîó Human Trust Graph"}
              </button>
              {/* Mode toggle */}
              {!running && (
                <div style={{ display: "flex", borderRadius: 6, overflow: "hidden", border: "1px solid #333" }}>
                  <button onClick={() => setPlayMode("auto")}
                    style={{ padding: "8px 12px", background: playMode === "auto" ? `${sc.color}33` : "#111", border: "none", color: playMode === "auto" ? sc.color : "#666", cursor: "pointer", fontSize: 10, fontFamily: "inherit", fontWeight: playMode === "auto" ? 700 : 400 }}>
                    ‚ñ∂ Auto
                  </button>
                  <button onClick={() => setPlayMode("step")}
                    style={{ padding: "8px 12px", background: playMode === "step" ? `${sc.color}33` : "#111", border: "none", borderLeft: "1px solid #333", color: playMode === "step" ? sc.color : "#666", cursor: "pointer", fontSize: 10, fontFamily: "inherit", fontWeight: playMode === "step" ? 700 : 400 }}>
                    ‚è≠ Step
                  </button>
                </div>
              )}
              {/* Run / Step / Reset buttons */}
              {running && playMode === "step" ? (
                <div style={{ display: "flex", gap: 6 }}>
                  <button onClick={stepForward}
                    disabled={phase === "complete"}
                    style={{ padding: "10px 24px", background: phase === "complete" ? "#333" : sc.color, color: "white", border: "none", borderRadius: 6, cursor: phase === "complete" ? "default" : "pointer", fontSize: 13, fontWeight: 700, fontFamily: "inherit", letterSpacing: 1, opacity: phase === "complete" ? 0.5 : 1 }}>
                    {phase === "complete" ? "‚úì DONE" : `NEXT ‚Üí ${stepDisplay + 2}/${sc.events.length}`}
                  </button>
                  <button onClick={reset}
                    style={{ padding: "10px 16px", background: "#B71C1C", color: "white", border: "none", borderRadius: 6, cursor: "pointer", fontSize: 13, fontWeight: 700, fontFamily: "inherit" }}>
                    ‚ñ†
                  </button>
                </div>
              ) : (
                <button onClick={running ? reset : runScenario}
                  style={{ padding: "10px 28px", background: running ? "#B71C1C" : sc.color, color: "white", border: "none", borderRadius: 6, cursor: "pointer", fontSize: 13, fontWeight: 700, fontFamily: "inherit", letterSpacing: 1, minWidth: 160 }}>
                  {running ? "‚ñ† RESET" : "‚ñ∂ RUN SCENARIO"}
                </button>
              )}
            </div>
          </div>

          {/* VAT Token Explainer (toggle) */}
          {showVATExplainer && (
            <div style={{ padding: "16px 20px", background: "#0a1628", borderBottom: "1px solid #1a3050", fontFamily: "-apple-system, 'Segoe UI', sans-serif" }}>
              <div style={{ fontSize: 16, fontWeight: 700, color: "#2E75B6", marginBottom: 12 }}>The VAT Token ‚Äî The World's Only 5-Modal Biometric Human Key</div>
              <div style={{ fontSize: 13, color: "#ccc", lineHeight: 1.8, maxWidth: 800 }}>
                A <strong style={{ color: "#5DADE2" }}>Verified Authority Token (VAT)</strong> is a cryptographic proof that a real, specific human authorised a specific action. Not a password. Not a code from your phone. A proof anchored to <em>who you physically are, how you behave, where you are, and when</em> ‚Äî across five modalities simultaneously.
              </div>

              <div style={{ display: "grid", gridTemplateColumns: "1fr 1fr 1fr", gap: 10, marginTop: 16, maxWidth: 900 }}>
                <div style={{ padding: "12px 14px", background: "#111", borderRadius: 6, borderLeft: "3px solid #4CAF50" }}>
                  <div style={{ fontSize: 13, fontWeight: 700, color: "#4CAF50" }}>üìπ Video ‚Äî Your Face</div>
                  <div style={{ fontSize: 12, color: "#aaa", marginTop: 4, lineHeight: 1.6 }}>Live facial recognition with liveness detection. Not a photo ‚Äî a proof you're present, right now. Deepfake-resistant.</div>
                </div>
                <div style={{ padding: "12px 14px", background: "#111", borderRadius: 6, borderLeft: "3px solid #5DADE2" }}>
                  <div style={{ fontSize: 13, fontWeight: 700, color: "#5DADE2" }}>üéô Voice ‚Äî Your Voiceprint</div>
                  <div style={{ fontSize: 12, color: "#aaa", marginTop: 4, lineHeight: 1.6 }}>Unique voiceprint matching. Cross-checked against your face ‚Äî lip movements must match your voice. Clone-resistant.</div>
                </div>
                <div style={{ padding: "12px 14px", background: "#111", borderRadius: 6, borderLeft: "3px solid #FFB74D" }}>
                  <div style={{ fontSize: 13, fontWeight: 700, color: "#FFB74D" }}>‚å®Ô∏è Behavioural ‚Äî How You Act</div>
                  <div style={{ fontSize: 12, color: "#aaa", marginTop: 4, lineHeight: 1.6 }}>Typing patterns, interaction rhythms, device signals. A behavioural fingerprint unique to you and nearly impossible to replicate.</div>
                </div>
                <div style={{ padding: "12px 14px", background: "#111", borderRadius: 6, borderLeft: "3px solid #CE93D8" }}>
                  <div style={{ fontSize: 13, fontWeight: 700, color: "#CE93D8" }}>üìç Location ‚Äî Where You Are</div>
                  <div style={{ fontSize: 12, color: "#aaa", marginTop: 4, lineHeight: 1.6 }}>Geolocation verification. If you're meant to be in Auckland, a login from Moscow gets flagged ‚Äî before anything happens.</div>
                </div>
                <div style={{ padding: "12px 14px", background: "#111", borderRadius: 6, borderLeft: "3px solid #EF5350" }}>
                  <div style={{ fontSize: 13, fontWeight: 700, color: "#EF5350" }}>‚è± Temporal ‚Äî When & How Long</div>
                  <div style={{ fontSize: 12, color: "#aaa", marginTop: 4, lineHeight: 1.6 }}>Trust decays over time. Permissions expire. How long you stay, how quickly you decide, when you're active ‚Äî all signals. A rƒÅhui lifts after 6 months. A doctor's shift ends at 6pm. Time is a biometric.</div>
                </div>
              </div>

              <div style={{ marginTop: 16, padding: "14px 16px", background: "#0d1a0d", borderRadius: 6, border: "1px solid #2D5A27" }}>
                <div style={{ fontSize: 13, fontWeight: 700, color: "#4CAF50", marginBottom: 6 }}>Why This Is Unique ‚Äî And Patented</div>
                <div style={{ fontSize: 12, color: "#bbb", lineHeight: 1.7 }}>
                  Every existing identity system uses one or two of these. Auth0 uses passwords. iProov uses face only. Nuance uses voice only. <strong style={{ color: "#fff" }}>Nobody combines all five into a single composite trust score where trust continuously decays and must be re-earned.</strong> A deepfake might fool a camera. It won't fool a camera + voiceprint + behavioural pattern + location + temporal consistency check simultaneously. And even if it could ‚Äî in 60 seconds the trust score drops and re-verification is required.
                </div>
              </div>

              <div style={{ display: "flex", gap: 16, marginTop: 14 }}>
                <div style={{ flex: 1, padding: "10px 14px", background: "#111", borderRadius: 6, borderLeft: "3px solid #4CAF50" }}>
                  <div style={{ fontSize: 11, fontWeight: 700, color: "#4CAF50" }}>Creates</div>
                  <div style={{ fontSize: 11, color: "#aaa", marginTop: 4 }}>5 biometric signals ‚Üí one trust score ‚Üí token is born</div>
                </div>
                <div style={{ flex: 1, padding: "10px 14px", background: "#111", borderRadius: 6, borderLeft: "3px solid #5DADE2" }}>
                  <div style={{ fontSize: 11, fontWeight: 700, color: "#5DADE2" }}>Delegates</div>
                  <div style={{ fontSize: 11, color: "#aaa", marginTop: 4 }}>Each agent gets a narrower copy ‚Äî scope always narrows</div>
                </div>
                <div style={{ flex: 1, padding: "10px 14px", background: "#111", borderRadius: 6, borderLeft: "3px solid #EF5350" }}>
                  <div style={{ fontSize: 11, fontWeight: 700, color: "#EF5350" }}>Revokes</div>
                  <div style={{ fontSize: 11, color: "#aaa", marginTop: 4 }}>Human leaves ‚Üí ALL agents stop. Instantly. No orphaned access.</div>
                </div>
              </div>

              <div style={{ marginTop: 12, fontSize: 10, color: "#555", fontFamily: "'Courier New', monospace" }}>
                Protected by 241 claims across 4 Australian patent filings ¬∑ Violet Shores Pty Ltd ¬∑ vacprotocol.org
              </div>
            </div>
          )}

          {/* Human Trust Graph Explainer */}
          {showTrustGraph && (
            <div style={{ padding: "16px 20px", background: "#0d0a1a", borderBottom: "1px solid #2a1a3a", fontFamily: "-apple-system, 'Segoe UI', sans-serif" }}>
              <div style={{ fontSize: 16, fontWeight: 700, color: "#CE93D8", marginBottom: 12 }}>The Human Trust Graph ‚Äî Why Social Verification Changes Everything</div>

              <div style={{ fontSize: 13, color: "#ccc", lineHeight: 1.8, maxWidth: 800 }}>
                Every identity system today verifies you against a <em>database</em> ‚Äî a password file, a government record, a biometric template stored on a server. <strong style={{ color: "#CE93D8" }}>VAC verifies you against other humans who know you.</strong> That's a fundamentally different kind of trust.
              </div>

              <div style={{ fontSize: 13, color: "#aaa", lineHeight: 1.8, marginTop: 10, maxWidth: 800 }}>
                When you onboard to a VAC-powered app, a real person who knows you ‚Äî a colleague, a teacher, a family member ‚Äî records a short video vouching for your identity. Their vouch is cryptographically linked to both their biometric proof and yours. This creates a <strong style={{ color: "#fff" }}>social trust graph</strong>: a web of human relationships where every connection is biometrically anchored.
              </div>

              {/* Visual Trust Graph */}
              <div style={{ marginTop: 16, padding: "20px", background: "#111", borderRadius: 8, border: "1px solid #222" }}>
                <div style={{ fontSize: 10, color: "#666", letterSpacing: 2, marginBottom: 12 }}>TRUST GRAPH ‚Äî WƒÄNANGA EXAMPLE</div>
                <svg viewBox="0 0 700 320" style={{ width: "100%", maxWidth: 700 }}>
                  {/* Connection lines */}
                  <line x1="350" y1="45" x2="200" y2="130" stroke="#CE93D866" strokeWidth="2" />
                  <line x1="350" y1="45" x2="500" y2="130" stroke="#CE93D866" strokeWidth="2" />
                  <line x1="200" y1="130" x2="500" y2="130" stroke="#CE93D844" strokeWidth="1" strokeDasharray="4" />
                  <line x1="200" y1="130" x2="150" y2="230" stroke="#5DADE266" strokeWidth="2" />
                  <line x1="200" y1="130" x2="280" y2="230" stroke="#5DADE266" strokeWidth="2" />
                  <line x1="500" y1="130" x2="420" y2="230" stroke="#5DADE266" strokeWidth="2" />
                  <line x1="500" y1="130" x2="550" y2="230" stroke="#5DADE266" strokeWidth="2" />
                  <line x1="350" y1="45" x2="350" y2="230" stroke="#4CAF5066" strokeWidth="2" />
                  {/* External vouches coming in */}
                  <line x1="50" y1="80" x2="200" y2="130" stroke="#FFB74D44" strokeWidth="1" strokeDasharray="6" />
                  <line x1="650" y1="80" x2="500" y2="130" stroke="#FFB74D44" strokeWidth="1" strokeDasharray="6" />

                  {/* KaumƒÅtua - top */}
                  <circle cx="350" cy="45" r="24" fill="#4A0E4E" stroke="#CE93D8" strokeWidth="2" />
                  <text x="350" y="49" textAnchor="middle" fill="#fff" fontSize="14">üë§</text>
                  <text x="350" y="82" textAnchor="middle" fill="#CE93D8" fontSize="10" fontWeight="700">Mere (KaumƒÅtua)</text>
                  <text x="350" y="94" textAnchor="middle" fill="#888" fontSize="8">‚≠ê ANCHOR ¬∑ 12 vouches ¬∑ Trust: 0.95</text>

                  {/* Kaiako - left */}
                  <circle cx="200" cy="130" r="20" fill="#1B5E20" stroke="#66BB6A" strokeWidth="2" />
                  <text x="200" y="134" textAnchor="middle" fill="#fff" fontSize="12">üë§</text>
                  <text x="200" y="163" textAnchor="middle" fill="#66BB6A" fontSize="10" fontWeight="700">Hemi (Kaiako)</text>
                  <text x="200" y="175" textAnchor="middle" fill="#888" fontSize="8">‚≠ê TRUSTED ¬∑ 7 vouches ¬∑ Trust: 0.90</text>

                  {/* WhƒÅnau rep - right */}
                  <circle cx="500" cy="130" r="20" fill="#1B5E20" stroke="#66BB6A" strokeWidth="2" />
                  <text x="500" y="134" textAnchor="middle" fill="#fff" fontSize="12">üë§</text>
                  <text x="500" y="163" textAnchor="middle" fill="#66BB6A" fontSize="10" fontWeight="700">WhƒÅnau Rep</text>
                  <text x="500" y="175" textAnchor="middle" fill="#888" fontSize="8">ESTABLISHED ¬∑ 4 vouches ¬∑ Trust: 0.88</text>

                  {/* Rangatahi */}
                  <circle cx="150" cy="230" r="16" fill="#1B3A5C" stroke="#5DADE2" strokeWidth="2" />
                  <text x="150" y="234" textAnchor="middle" fill="#fff" fontSize="10">üìπ</text>
                  <text x="150" y="258" textAnchor="middle" fill="#5DADE2" fontSize="9">Aroha</text>
                  <text x="150" y="268" textAnchor="middle" fill="#888" fontSize="7">EMERGING ¬∑ 1 vouch</text>

                  <circle cx="280" cy="230" r="16" fill="#1B3A5C" stroke="#5DADE2" strokeWidth="2" />
                  <text x="280" y="234" textAnchor="middle" fill="#fff" fontSize="10">üìπ</text>
                  <text x="280" y="258" textAnchor="middle" fill="#5DADE2" fontSize="9">Tama</text>
                  <text x="280" y="268" textAnchor="middle" fill="#888" fontSize="7">EMERGING ¬∑ 1 vouch</text>

                  <circle cx="350" cy="230" r="16" fill="#1B3A5C" stroke="#5DADE2" strokeWidth="2" />
                  <text x="350" y="234" textAnchor="middle" fill="#fff" fontSize="10">üìπ</text>
                  <text x="350" y="258" textAnchor="middle" fill="#5DADE2" fontSize="9">Maia</text>
                  <text x="350" y="268" textAnchor="middle" fill="#888" fontSize="7">EMERGING ¬∑ 1 vouch</text>

                  <circle cx="420" cy="230" r="16" fill="#1B3A5C" stroke="#5DADE2" strokeWidth="2" />
                  <text x="420" y="234" textAnchor="middle" fill="#fff" fontSize="10">üìπ</text>
                  <text x="420" y="258" textAnchor="middle" fill="#5DADE2" fontSize="9">Wiremu</text>
                  <text x="420" y="268" textAnchor="middle" fill="#888" fontSize="7">EMERGING ¬∑ 1 vouch</text>

                  <circle cx="550" cy="230" r="16" fill="#1B3A5C" stroke="#5DADE2" strokeWidth="2" />
                  <text x="550" y="234" textAnchor="middle" fill="#fff" fontSize="10">üìπ</text>
                  <text x="550" y="258" textAnchor="middle" fill="#5DADE2" fontSize="9">Hine</text>
                  <text x="550" y="268" textAnchor="middle" fill="#888" fontSize="7">EMERGING ¬∑ 1 vouch</text>

                  {/* External vouchers */}
                  <circle cx="50" cy="80" r="12" fill="#333" stroke="#FFB74D" strokeWidth="1" strokeDasharray="3" />
                  <text x="50" y="84" textAnchor="middle" fill="#FFB74D" fontSize="8">üë§</text>
                  <text x="50" y="102" textAnchor="middle" fill="#666" fontSize="7">External vouch</text>

                  <circle cx="650" cy="80" r="12" fill="#333" stroke="#FFB74D" strokeWidth="1" strokeDasharray="3" />
                  <text x="650" y="84" textAnchor="middle" fill="#FFB74D" fontSize="8">üë§</text>
                  <text x="650" y="102" textAnchor="middle" fill="#666" fontSize="7">External vouch</text>

                  {/* Badge labels */}
                  <text x="350" y="310" textAnchor="middle" fill="#555" fontSize="9">Each line = a biometrically verified vouch. Each vouch strengthens the graph. The graph IS the moat.</text>
                </svg>
              </div>

              {/* Badge progression */}
              <div style={{ display: "flex", gap: 10, marginTop: 14 }}>
                <div style={{ flex: 1, padding: "10px 12px", background: "#111", borderRadius: 6, borderLeft: "3px solid #5DADE2" }}>
                  <div style={{ fontSize: 11, fontWeight: 700, color: "#5DADE2" }}>üå± Emerging (1 vouch)</div>
                  <div style={{ fontSize: 11, color: "#888", marginTop: 2 }}>New to the graph. One person vouched for you. Trust is limited but real.</div>
                </div>
                <div style={{ flex: 1, padding: "10px 12px", background: "#111", borderRadius: 6, borderLeft: "3px solid #66BB6A" }}>
                  <div style={{ fontSize: 11, fontWeight: 700, color: "#66BB6A" }}>üåø Established (3+)</div>
                  <div style={{ fontSize: 11, color: "#888", marginTop: 2 }}>Multiple people confirm you. Cross-referencing begins. Harder to fake.</div>
                </div>
                <div style={{ flex: 1, padding: "10px 12px", background: "#111", borderRadius: 6, borderLeft: "3px solid #FFB74D" }}>
                  <div style={{ fontSize: 11, fontWeight: 700, color: "#FFB74D" }}>üå≥ Trusted (5+)</div>
                  <div style={{ fontSize: 11, color: "#888", marginTop: 2 }}>Deep connections. Your identity is socially verified across multiple contexts.</div>
                </div>
                <div style={{ flex: 1, padding: "10px 12px", background: "#111", borderRadius: 6, borderLeft: "3px solid #CE93D8" }}>
                  <div style={{ fontSize: 11, fontWeight: 700, color: "#CE93D8" }}>‚≠ê Anchor (10+)</div>
                  <div style={{ fontSize: 11, color: "#888", marginTop: 2 }}>A pillar of the graph. Others trust you to vouch. Your departure would be felt.</div>
                </div>
              </div>

              <div style={{ marginTop: 14, padding: "12px 16px", background: "#0d1a0d", borderRadius: 6, border: "1px solid #2D5A27" }}>
                <div style={{ fontSize: 13, fontWeight: 700, color: "#4CAF50", marginBottom: 6 }}>Why This Is The Moat</div>
                <div style={{ fontSize: 12, color: "#bbb", lineHeight: 1.7 }}>
                  You can copy a protocol. You can replicate a patent (eventually). But you cannot copy a social graph. Every vouch is a real relationship between real people, biometrically anchored. The more people who join, the more vouches exist, the stronger every identity becomes. <strong style={{ color: "#fff" }}>The graph creates switching costs that no competitor can overcome</strong> ‚Äî because the value isn't in the software, it's in the human connections the software has verified.
                </div>
              </div>
            </div>
          )}

          {/* Story Content */}
          {sc.story && (
            <div style={{ padding: "16px 20px", background: "#0d0d0d", fontFamily: "-apple-system, 'Segoe UI', sans-serif" }}>
              {/* Intro - always shown */}
              <div style={{ fontSize: 14, color: "#ddd", lineHeight: 1.8, maxWidth: 800 }}>
                {sc.story.intro}
              </div>

              {/* Why VAC - shown when idle */}
              {phase === "idle" && (
                <div style={{ marginTop: 14, padding: "12px 16px", background: `${sc.color}0a`, borderRadius: 6, borderLeft: `3px solid ${sc.color}` }}>
                  <div style={{ fontSize: 11, fontWeight: 700, color: sc.color, marginBottom: 4, letterSpacing: 1 }}>WHY VAC?</div>
                  <div style={{ fontSize: 13, color: "#bbb", lineHeight: 1.7 }}>{sc.story.whyVAC}</div>
                </div>
              )}

              {/* Narrative beat - shown during/after run */}
              {currentBeat >= 0 && sc.story.beats && sc.story.beats[currentBeat] && (
                <div style={{ marginTop: 14, padding: "14px 16px", background: "#111", borderRadius: 6, borderLeft: `3px solid ${sc.color}`, transition: "all 0.3s ease" }}>
                  <div style={{ fontSize: 10, color: sc.color, marginBottom: 6, letterSpacing: 1, fontWeight: 700 }}>
                    WHAT'S HAPPENING{stepDisplay >= 0 ? ` ‚Äî Event ${stepDisplay + 1} of ${sc.events.length}` : ""}
                  </div>
                  <div style={{ fontSize: 14, color: "#eee", lineHeight: 1.7 }}>
                    {sc.story.beats[currentBeat].text}
                  </div>
                </div>
              )}
            </div>
          )}
        </div>

        {/* Interactive Decision Buttons */}
        {phase === "choose_crisis" && (
          <div style={{ marginBottom: 12, padding: 16, background: "#1a1200", borderRadius: 8, border: "2px solid #FF6F00" }}>
            <div style={{ fontSize: 12, fontWeight: 700, color: "#FF6F00", marginBottom: 10 }}>‚ö° CHOOSE WHAT HAPPENS TO MEMBER 3:</div>
            <div style={{ display: "flex", gap: 8, flexWrap: "wrap" }}>
              {Object.entries(CONSORTIUM_BRANCHES).map(([key, b]) => (
                <button key={key} onClick={() => handleCrisisChoice(key)}
                  style={{ padding: "10px 18px", background: `${b.color}22`, border: `1px solid ${b.color}`, borderRadius: 6, color: b.color, cursor: "pointer", fontSize: 11, fontFamily: "inherit", fontWeight: 600, flex: 1, minWidth: 140 }}>
                  {b.icon} {b.label}<br /><span style={{ fontSize: 9, fontWeight: 400, opacity: 0.8 }}>{b.desc}</span>
                </button>
              ))}
            </div>
          </div>
        )}

        {phase === "choose_escalate" && (
          <div style={{ marginBottom: 12, padding: 16, background: "#1a0000", borderRadius: 8, border: "2px solid #EF5350" }}>
            <div style={{ fontSize: 12, fontWeight: 700, color: "#EF5350", marginBottom: 10 }}>üí• ESCALATE ‚Äî WHAT HAPPENS NEXT?</div>
            <div style={{ display: "flex", gap: 8, flexWrap: "wrap" }}>
              <button onClick={() => handleEscalate("quorum")}
                style={{ padding: "12px 18px", background: "#EF535022", border: "1px solid #EF5350", borderRadius: 6, color: "#EF5350", cursor: "pointer", fontSize: 11, fontFamily: "inherit", fontWeight: 600, flex: 1 }}>
                üí• Drop Below Quorum<br /><span style={{ fontSize: 9, fontWeight: 400 }}>Two more members lost ‚Üí 4/7 ‚Üí CASCADE</span>
              </button>
              <button onClick={() => handleEscalate("kaumatua")}
                style={{ padding: "12px 18px", background: "#CE93D822", border: "1px solid #CE93D8", borderRadius: 6, color: "#CE93D8", cursor: "pointer", fontSize: 11, fontFamily: "inherit", fontWeight: 600, flex: 1 }}>
                üèõ KaumƒÅtua Withdraws<br /><span style={{ fontSize: 9, fontWeight: 400 }}>Mandatory role lost ‚Üí CASCADE despite 5/7 quorum</span>
              </button>
            </div>
          </div>
        )}

        {phase === "cascaded" && (
          <div style={{ marginBottom: 12, padding: 16, background: "#001a0a", borderRadius: 8, border: "2px solid #4CAF50" }}>
            <div style={{ fontSize: 12, fontWeight: 700, color: "#4CAF50", marginBottom: 10 }}>üîÑ RECOVERY ‚Äî RECONSTITUTE THE CONSORTIUM?</div>
            <button onClick={handleReconstitute}
              style={{ padding: "12px 28px", background: "#4CAF5022", border: "1px solid #4CAF50", borderRadius: 6, color: "#4CAF50", cursor: "pointer", fontSize: 12, fontFamily: "inherit", fontWeight: 700 }}>
              üîÑ Reconstitute Consortium ‚Äî Appoint replacement, re-verify, resume mission
            </button>
          </div>
        )}

        {/* Main Layout */}
        <div style={{ display: "grid", gridTemplateColumns: "1fr 340px", gap: 16 }}>
          {/* Left: Graph + Metrics */}
          <div>
            <div style={{ background: "#0d0d0d", borderRadius: 8, border: "1px solid #222", overflow: "hidden" }}>
              <div style={{ padding: "8px 16px", borderBottom: "1px solid #1a1a1a", display: "flex", justifyContent: "space-between" }}>
                <span style={{ fontSize: 10, color: "#666", letterSpacing: 2 }}>TRUST GRAPH ‚Äî LIVE</span>
                <span style={{ fontSize: 10, color: sc.color }}>{activeNodes.size} nodes ¬∑ {safeStateNodes.size > 0 ? `${safeStateNodes.size} safe state` : `${revokedNodes.size} revoked`}</span>
              </div>
              <TrustGraph scenario={scenario} activeNodes={activeNodes} revokedNodes={revokedNodes} blockedNodes={blockedNodes} safeStateNodes={safeStateNodes} quorumText={quorumText} />
            </div>
            <MetricsPanel metrics={metrics} />
          </div>

          {/* Right: Event Log + Scope */}
          <div style={{ display: "flex", flexDirection: "column", gap: 12 }}>
            <div style={{ background: "#0d0d0d", borderRadius: 8, border: "1px solid #222", flex: 1, minHeight: 300, maxHeight: 420, display: "flex", flexDirection: "column" }}>
              <div style={{ padding: "8px 12px", borderBottom: "1px solid #1a1a1a" }}>
                <span style={{ fontSize: 10, color: "#666", letterSpacing: 2 }}>EVENT LOG</span>
              </div>
              <div style={{ flex: 1, overflow: "auto", padding: "8px 12px" }}>
                {log.length === 0 && (
                  <div style={{ color: "#444", fontSize: 11, textAlign: "center", marginTop: 40 }}>
                    {playMode === "step" ? "Press RUN SCENARIO to begin stepping through" : "Press RUN SCENARIO to begin"}
                  </div>
                )}
                {log.map((entry, i) => (
                  <div key={i} style={{ fontSize: 10, marginBottom: 5, lineHeight: 1.4, opacity: i === log.length - 1 ? 1 : 0.7 }}>
                    <span style={{ color: "#444" }}>{entry.time}</span>{" "}
                    <span style={{ color: eventColors[entry.type] || "#888", fontWeight: 600 }}>
                      [{entry.type.toUpperCase().replace("_"," ")}]
                    </span>{" "}
                    <span style={{ color: "#ccc" }}>{entry.message}</span>
                  </div>
                ))}
                <div ref={logEndRef} />
              </div>
            </div>

            <div style={{ background: "#0d0d0d", borderRadius: 8, border: "1px solid #222", padding: 12 }}>
              <div style={{ fontSize: 10, color: "#666", letterSpacing: 2, marginBottom: 8 }}>SCOPE INSPECTOR</div>
              {sc.nodes.filter(n => activeNodes.has(n.id)).slice(-4).reverse().map(node => (
                <div key={node.id} style={{ marginBottom: 6, padding: "5px 8px", background: "#111", borderRadius: 4, borderLeft: `3px solid ${safeStateNodes.has(node.id) ? "#2196F3" : revokedNodes.has(node.id) ? "#EF5350" : blockedNodes.has(node.id) ? "#FF4444" : NODE_STYLES[node.type]?.stroke || "#555"}` }}>
                  <div style={{ fontSize: 10, fontWeight: 700, color: safeStateNodes.has(node.id) ? "#2196F3" : revokedNodes.has(node.id) ? "#EF5350" : "#ccc" }}>{node.label}</div>
                  <div style={{ fontSize: 9, color: "#888" }}>Scope: {node.scope}</div>
                  <div style={{ fontSize: 9, color: "#666" }}>Jurisdiction: {node.jurisdiction}</div>
                  {node.role && <div style={{ fontSize: 9, color: "#888" }}>Role: {node.role}</div>}
                </div>
              ))}
              {activeNodes.size === 0 && <div style={{ fontSize: 10, color: "#444" }}>No active nodes</div>}
            </div>
          </div>
        </div>

        {/* Footer */}
        <div style={{ marginTop: 16, padding: "12px 16px", background: "#0d0d0d", borderRadius: 8, border: "1px solid #1a1a1a", display: "flex", justifyContent: "space-between", alignItems: "center" }}>
          <div style={{ fontSize: 10, color: "#444" }}>
            VAC Protocol Simulation v3.0 ‚Äî For demonstration purposes. Real implementation uses Ed25519 cryptographic signatures.
          </div>
          <div style={{ fontSize: 10, color: "#555" }}>
            ¬© 2026 Violet Shores Pty Ltd | vacprotocol.org
          </div>
        </div>
      </div>
    </div>
  );
}

function App() {
  return React.createElement('div', { style: { paddingTop: '48px' } },
    React.createElement(VACSimulation)
  );
}
ReactDOM.createRoot(document.getElementById('root')).render(React.createElement(App));
</script>
</body>
</html>
